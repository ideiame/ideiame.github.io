
<!DOCTYPE html>
<html lang="en" class="dark-mode">
  <head>
    <!-- Google tag (gtag.js) -->
<link rel="stylesheet"
    type="text/css"
    href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js"
    data-cfasync="false"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NV80WM9HT0"></script>
<script>
    // Reads the value of a cookie by name or returns empty string
    function getCookie(name) {
        var b = document.cookie.match('(^|[^;]+)\\s*' + name + '\\s*=\\s*([^;]+)');
        return b ? b.pop() : '';
    }

    // Actually starting analytics up
    function addAnalytics() {
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());
        gtag('config', 'G-NV80WM9HT0');
    }

    // Waiting for the load event
    window.addEventListener("load", function () {
        // Reading "cookieconsent_status" cookie
        const cookieConsent = getCookie('cookieconsent_status');

        // Start analytics if user consented or did not deny
        if (cookieConsent === 'allow' || cookieConsent === '') {
            addAnalytics();
        }

        // Initialise cookie consent banner
        window.cookieconsent.initialise({
            "palette": {
                "popup": {
                    "background": "#efefef",
                    "text": "#404040"
                },
                "button": {
                    "background": "#8ec760",
                    "text": "#ffffff"
                }
            },
            "type": "opt-out",
            "content": {
                "allow": "Approve",
                "dismiss": "Approve",
                "deny": "Reject"
            },
            // Reload the page on user choice to make sure cookie is set
            onStatusChange: function (status, chosenBefore) {
                location.reload();
            }
        })
    });
</script>

    <script async
src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1171230226237014"
crossorigin="anonymous"></script>

    <meta charset="utf-8">
    <title>Time Series Benchmark Timescaledb Raspberry Pi</title>
    <meta name="description" content="I started supporting tsbs project, and this weekend I decided to try to run it on my Raspberry Pi version 3.">
    <meta name="author" content="Jônatas Davi Paganini">

    <!-- Always use dark mode -->
    <script>
      (function() {
        document.documentElement.classList.add('dark-mode');
        document.write('<style>body,html{background-color:#0c0c0c!important;color:#f0f2f5!important;}div{background-color:transparent!important;}</style>');
      })();
    </script>

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- JetBrains Mono and other developer fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Modern stylesheet links -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
    
    <!-- Site styles -->
    <link href="/css/nimbus-pygments.css" rel="stylesheet">
    <link href="/css/modern-theme.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <!-- Modern JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="/js/modern-effects.js"></script>
    
    <!-- GitHub-style code block enhancement -->
    <script src="/js/github-code-blocks.js"></script>
    
    <div id="fb-root"></div>

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
  <script type="text/javascript" language="javascript" charset="utf-8">
// <![CDATA[
    addEventListener('load', function (event) {
      var agent=navigator.userAgent.toLowerCase();
      var links = document.getElementsByTagName('a');
      var regex = new RegExp('^'+window.location.protocol + '//' + window.location.hostname);

      for (var i = 0, linksLength = links.length; i < linksLength; i++) {
        if ( ! links[i].href.match(regex)) {
           links[i].setAttribute('target', '_blank');
       }
     }

    }, false);
// ]]>
</script>
</head>
<body class="dark-mode">
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v2.5&appId=138593009602387";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

    <!-- Geometric background pattern -->
    <div class="geometric-bg"></div>

    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
      <div class="container">
        <a class="navbar-brand py-0" href="/">
          <span class="logo">
            <span class="i">i</span>
            <span class="d">d</span>
            <span class="e">e</span>
            <span class="i2">i</span>
            <span class="a">a</span>
            <span class="dot">.</span>
            <span class="m">m</span>
            <span class="e2">e</span>
          </span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain" aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarMain">
          <ul class="navbar-nav">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle py-1" href="#" id="pagesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              </a>
              <ul class="dropdown-menu shadow-sm glass-card" aria-labelledby="pagesDropdown">
                <li><a class="dropdown-item" href="/archive">Archive</a></li>
                <li><a class="dropdown-item" href="/talks">Talks</a></li>
                <li><a class="dropdown-item" href="/categories">Categories</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="https://www.linkedin.com/in/jonatasdp"><i class="bi bi-linkedin"></i> Linkedin</a></li>
                <li><a class="dropdown-item" href="https://github.com/jonatas"><i class="bi bi-github"></i> Github</a></li>
                <li><a class="dropdown-item" href="https://twitter.com/jonatasdp"><i class="bi bi-twitter"></i> Twitter</a></li>
                <li><a class="dropdown-item" href="https://instagram.com/jonatasdp"><i class="bi bi-instagram"></i> Instagram</a></li>
                <li><a class="dropdown-item" href="https://www.youtube.com/user/jonatasdp"><i class="bi bi-youtube"></i> Youtube</a></li>
              </ul>
            </li>
          </ul>
          
          <div class="d-none d-md-block page-title-nav me-auto ms-2">
            Time Series Benchmark Timescaledb Raspberry Pi
          </div>
          
        </div>
      </div>
    </nav>
    
    <div class="container content-container mt-5 pt-5">
      

<div class="article-wrapper">
  <div class="article-header">
    <div class="article-meta">
      <span><i class="bi bi-calendar3"></i> May 24, 2021</span>
      <span class="separator">•</span>
      
  
  
    <span class="reading-time" title="Estimated read time">
      <i class="bi bi-clock"></i> 16 min read
    </span>
  
 
      
      
      <span class="separator">•</span>
      <span>
        <i class="bi bi-folder"></i> 
        
      </span>
      
    </div>
  </div>
  
  <div class="article-content">
    <p>I started supporting <a href="https://github.com/timescale/tsbs">tsbs</a> project, and
this weekend I decided to try to run it on my Raspberry Pi version 3.</p>

<p>Here I’ll share a bit of my saga to make it work and all the steps I followed to
benchmark Postgresql with <a href="https://docs.timescale.com/">TimescaleDB</a>.</p>

<h2 id="setup-environment">Setup environment</h2>

<p>If you want to try this, the first thing you need to do is download an Ubuntu image to load in your Pi.
I have an old one here, so, I updated it recently with the following command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt dist-upgrade
</code></pre></div></div>

<p>It will take a while and maybe go into some crazy errors. To me, I have to
force it to go.</p>

<h3 id="disable-gui-interface">Disable GUI interface</h3>

<p>We’re just going to access the machine via ssh, so it would be better to have
less process running as possible. As ubuntu mate brings interface enabled by
default, let’s disable it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl set-default multi-user.target --force
systemctl disable lightdm.service --force
systemctl disable graphical.target --force
systemctl disable plymouth.service --force
</code></pre></div></div>

<h3 id="installing-latest-go-version">Installing latest go version</h3>

<p><a href="https://github.com/timescale/tsbs">tsbs</a> is written in go, and we’re going to
build it inside the Raspberry Pi. You can download it with the following command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /tmp
wget https://dl.google.com/go/go1.14.4.linux-armv6l.tar.gz
</code></pre></div></div>

<p>Now, the next step is to extract it into <code class="language-plaintext highlighter-rouge">/usr/local</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo tar -C /usr/local -xzf go1.14.4.linux-armv6l.tar.gz
</code></pre></div></div>

<p>Edit your <code class="language-plaintext highlighter-rouge">~/.profile</code>  to configure <code class="language-plaintext highlighter-rouge">PATH</code> and <code class="language-plaintext highlighter-rouge">GOPATH</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PATH=$PATH:/usr/local/go/bin
GOPATH=$HOME/go
</code></pre></div></div>

<p>Now, we still need to create the <code class="language-plaintext highlighter-rouge">GOPATH</code> folder:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir $HOME/go
</code></pre></div></div>

<p>and then we can source the <code class="language-plaintext highlighter-rouge">.profile</code> to reload the configuration:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source ~/.profile
</code></pre></div></div>

<p>Now, double-checking the version:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jonatas@rpi-3:~$ go version
go version go1.14.4 Linux/arm
</code></pre></div></div>

<h3 id="running-timescaledb-via-docker">Running timescaledb via docker</h3>

<p>Just make sure you don’t have Postgres running:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo service PostgreSQL stop
</code></pre></div></div>

<h4 id="pulling-timescaledb-official-image">Pulling timescaledb official image</h4>

<p>Now, let’s run the image. It will automatically pull if you don’t have it
locally:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker run --name timescaledb -p 5432:5433 -e POSTGRES_PASSWORD=password timescale/timescaledb:latest-pg12
</code></pre></div></div>

<p>The first time you run it, the <a href="https://docs.timescale.com/timescaledb/latest/how-to-guides/configuration/timescaledb-tune/">timescaledb-tune</a>
will break it, and you’ll need to join the image via ssh and edit the configuration.</p>

<p>The tool outputs the following configuration:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker start timescaledb
docker exec -i -t timescaledb /bin/bash
</code></pre></div></div>

<p>You can learn more about how to edit the <code class="language-plaintext highlighter-rouge">postgresql.conf</code> inside a
timescale container <a href="https://docs.timescale.com/timescaledb/latest/how-to-guides/configuration/docker-config/">here</a>.</p>

<p>Here are the suggestions from the tool:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>shared_buffers = 223094kB
effective_cache_size = 669282kB
maintenance_work_mem = 111547kB
work_mem = 2788kB
timescaledb.max_background_workers = 8
max_worker_processes = 15
max_parallel_workers_per_gather = 2
max_parallel_workers = 4
wal_buffers = 6692kB
min_wal_size = 512MB
default_statistics_target = 500
random_page_cost = 1.1
checkpoint_completion_target = 0.9
max_connections = 20
max_locks_per_transaction = 64
autovacuum_max_workers = 10
autovacuum_naptime = 10
effective_io_concurrency = 200
timescaledb.last_tuned = '2021-05-22T23:23:57Z'
timescaledb.last_tuned_version = '0.11.0'
</code></pre></div></div>

<p>While testing, maybe you’ll end up running it multiple times, but you want to reuse the same name, you can remove the previous image. Here is a snippet for it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker rm $(sudo docker ps -aq --filter name=timescaledb)
</code></pre></div></div>

<p>While it pulls the image, we can get more time to install tsbs and take the
time to compile it.</p>

<h2 id="installing-tsbs">Installing tsbs</h2>

<p>Let’s get the tsbs project:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go get github.com/timescale/tsbs
</code></pre></div></div>

<p>Let’s join the folder:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd $GOPATH/src/github.com/timescale/tsbs
</code></pre></div></div>

<p>Now we can run <code class="language-plaintext highlighter-rouge">make all</code> to compile all the tool we need to benchmark
time-series databases.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make all
</code></pre></div></div>

<p>It will take a while: 10 to 15 minutes in this small hardware, enjoy your favorite drink ☕️</p>

<h2 id="configuring-environment-variables">Configuring environment variables</h2>

<p>Next step is get familiar with the tools and their purpose:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">tsbs_load</code> will let you benchmark the data load into a database (several in the <a href="https://github.com/timescale/tsbs#current-use-cases">list</a>).</li>
  <li><code class="language-plaintext highlighter-rouge">tsbs_run_queries_timescaledb</code> allows you to execute several types of queries widespread in IoT and DevOps ecosystems. <a href="https://github.com/timescale/tsbs#benchmarking-query-execution-performance">more here</a>.</li>
</ul>

<h2 id="running-tsbs">Running tsbs</h2>

<p>First, let’s generate some config to run, so it’s easy to change the variables
instead of keeping a long command line.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tsbs_load config
</code></pre></div></div>

<p>It will generate some config, let me share the one I used here:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>data-source:
  # data source type [SIMULATOR|FILE]
  type: SIMULATOR
  # generate data on the fly
  simulator:
    # each time the simulator advances in time it skips this amount of time
    log-interval: 10s
    # maximum number of points to simulate (limit)
    max-data-points: 1000000
    # number of hosts to simulate (each host has a different tag-set/label-set
    scale: 40
    # set seed to some number to have reproducible data be generated
    seed: 135
    # start time of simulation
    timestamp-start: "2021-01-01T10:00:00Z"
    # end time of simulation
    timestamp-end: "2021-01-04T08:00:00Z"
    # use case to simulate
    use-case: cpu-only
loader:
  db-specific:
    admin-db-name: postgres
    # set chunk time depending on server size
    chunk-time: 4h0m0s
    create-metrics-table: true
    field-index: VALUE-TIME
    field-index-count: 0
    force-text-format: false
    host: 0.0.0.0
    user: postgres
    pass: password
    port: 5432
    in-table-partition-tag: false
    log-batches:false
    partition-index: true
    partitions: 1
    postgres: sslmode=prefer
    time-index: true
    time-partition-index: false
    use-hypertable: true
    use-distributed-hypertable: false
    use-jsonb-tags: false
  runner:
    # the simulated data will be sent in batches of 'batch-size' points
    # to each worker
    batch-size: 10000
    # don't worry about this until you need to simulate data with scale &gt; 1000
    channel-capacity: "0"
    db-name: benchmark
    do-abort-on-exist: false
    do-create-db: true
    # set this to false if you want to see the speed of data generation
    do-load: true
    # don't worry about this until you need to simulate data with scale &gt; 1000
    flow-control: false
    hash-workers: true
    limit: 1000000
    reporting-period: 10s
    seed: 135
    workers: 2 
</code></pre></div></div>

<p>Running:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jonatas@rpi-3:~/go/src/github.com/timescale/tsbs$tsbs_load load timescaledb --config config.yaml Using config file: config.yaml
time,per. metric/s,metric total,overall metric/s,per. row/s,row total,overall row/s
%!(EXTRA uint64=10000)panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x125b4]

goroutine 56 [running]:
runtime/internal/atomic.goXadd64(0x2908824, 0x186a0, 0x0, 0x2, 0x2)
	/usr/local/go/src/runtime/internal/atomic/atomic_arm.go:103 +0x1c
github.com/timescale/tsbs/load.(*CommonBenchmarkRunner).work(0x29087e0, 0xc555a0, 0x29ac7c0, 0x2f1a640, 0x29b2928, 0x1)
	/home/jonatas/go/src/github.com/timescale/tsbs/load/loader.go:248 +0x1ec
created by github.com/timescale/tsbs/load.(*CommonBenchmarkRunner).RunBenchmark
	/home/jonatas/go/src/github.com/timescale/tsbs/load/loader.go:160 +0xd8
</code></pre></div></div>

<p>Oh, we got an error :sad panda:</p>

<p>Looks like the error is around <a href="https://github.com/timescale/tsbs/blob/master/load/loader.go#L247">here</a>.</p>

<p>Let’s check if it makes something in the database:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>psql benchmark -h 0.0.0.0 -U postgres
Password for user Postgres:
psql (10.16 (Ubuntu 10.16-0ubuntu0.18.04.1), server 12.6)
WARNING: psql major version 10, server major version 12.
         Some psql features might not work.
Type "help" for help.
</code></pre></div></div>

<p>Checking the tables with <code class="language-plaintext highlighter-rouge">\dt</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>benchmark=# \dt
        List of relations
 Schema | Name | Type  |  Owner
--------+------+-------+----------
 public | CPU  | table | Postgres
 public | tags | table | Postgres
(2 rows)
</code></pre></div></div>

<p>Great! it created the tables  :)</p>

<p>Now, let’s see if it was able to insert something:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>benchmark=# select count(1) from cpu;
 count
-------
 20000
(1 row)

benchmark=# select count(1)  from tags ;
 count
-------
    40
(1 row)
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">40</code> tags as set in the configuration.</p>

<p>Exactly the numbers we have as limits in our system!</p>

<p>Let’s try to understand the error putting one infamous printing line to get what we have in the context:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">--- a/load/loader.go
</span><span class="gi">+++ b/load/loader.go
</span><span class="p">@@ -245,6 +245,7 @@</span> func (l *CommonBenchmarkRunner) work(b targets.Benchmark, wg *sync.WaitGroup, c
        for batch := range c.toWorker {
                startedWorkAt := time.Now()
                metricCnt, rowCnt := proc.ProcessBatch(batch, l.DoLoad)
<span class="gi">+               printFn("loaded metricCnt %d with rowCnt %d\n",metricCnt, rowCnt)
</span></code></pre></div></div>

<p>Now, let’s compile tsbs loaders and rerun it. To compile only the loaders
you can use a make task:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make loaders
</code></pre></div></div>

<p>But this task will compile all loaders and on a Raspberry, all resources are
limited. Let’s cherry-pick only the builds we’re using:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make tsbs_load tsbs_load_timescaledb
</code></pre></div></div>

<p>You should see several lines in the output like these:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GO111MODULE=on go get ./cmd/tsbs_load
GO111MODULE=ontsbs_load ./cmd/tsbs_load
GO111MODULE=on go install ./cmd/tsbs_load
GO111MODULE=on go get ./cmd/tsbs_load_timescaledb
GO111MODULE=ontsbs_load_timescaledb ./cmd/tsbs_load_timescaledb
GO111MODULE=on go install ./cmd/tsbs_load_timescaledb
</code></pre></div></div>

<p>Running again:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/tsbs_load load timescaledb --config config.yaml Using config file: config.yaml
time,per. metric/s,metric total,overall metric/s,per. row/s,row total,overall row/s
loaded metricCnt 100000 with rowCnt 10000
panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x125b4]
</code></pre></div></div>

<p>Well, looks like the rows are being inserted, but some other pointer reference is
nil.</p>

<p>Wow! Inspecting the <code class="language-plaintext highlighter-rouge">atomic.AddUInt64</code> is responsible for such <a href="https://github.com/golang/go/issues/23345">bug only on
arm</a>. Funny, no? Let’s go deep and
see how it works, because today I can learn about go deeper.</p>

<p>Here <a href="https://golang.org/src/sync/atomic/doc.go?s=1206:1659#L36">is the gift</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    46  // BUG(RSC): On 386, the 64-bit functions use instructions unavailable before the Pentium MMX.
    47  //
    48  // On non-Linux ARM, the 64-bit functions use instructions unavailable before the ARMv6k core.
    49  //
    50  // On ARM, 386, and 32-bit MIPS, it is the caller's responsibility
    51  // to arrange for 64-bit alignment of 64-bit words accessed atomically.
    52  // The first word in a variable or in an allocated struct, array, or slice can
    53  // be relied upon to be 64-bit aligned.
</code></pre></div></div>

<p>Now, I see that I need to find another way to implement this small counter.
Funny that I just want to sum two integers 🙀</p>

<p>Then, navigating in the issue details, I discovered this article about
<a href="https://go101.org/article/memory-layout.html">Type Alignment Guarantees</a>, the memory layout, which makes me learn many low-level things.</p>

<p>Wow! I’m not going that far if I cannot change this counter to make it run.</p>

<p>Let’s go! If you checked the previous post, you’ll see this <code class="language-plaintext highlighter-rouge">Counter</code> with a bit sized alignment that makes it possible to use <code class="language-plaintext highlighter-rouge">AddUInt64</code> without failures:</p>

<p>Here are the most important changes to make tsbs run with ARM 32bits environment:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// Some hacks to run on ARM 32 bits platforms</span>
<span class="c">// see: https://go101.org/article/memory-layout.html</span>
<span class="k">type</span> <span class="n">Counter</span> <span class="k">struct</span> <span class="p">{</span>
       <span class="n">x</span> <span class="p">[</span><span class="m">15</span><span class="p">]</span><span class="kt">byte</span> <span class="c">// instead of "x uint64"</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span><span class="n">Counter</span><span class="p">)</span> <span class="n">xAddr</span><span class="p">()</span> <span class="o">*</span><span class="kt">uint64</span> <span class="p">{</span>
       <span class="c">// The return must be 8-byte aligned.</span>
       <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="kt">uint64</span><span class="p">)(</span><span class="n">unsafe</span><span class="o">.</span><span class="n">Pointer</span><span class="p">(</span>
               <span class="p">(</span><span class="kt">uintptr</span><span class="p">(</span><span class="n">unsafe</span><span class="o">.</span><span class="n">Pointer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="m">7</span><span class="p">)</span> <span class="o">/</span> <span class="m">8</span> <span class="o">*</span> <span class="m">8</span><span class="p">))</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span><span class="n">Counter</span><span class="p">)</span> <span class="n">Add</span><span class="p">(</span><span class="n">delta</span> <span class="kt">uint64</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">p</span> <span class="o">:=</span> <span class="n">c</span><span class="o">.</span><span class="n">xAddr</span><span class="p">()</span>
       <span class="n">atomic</span><span class="o">.</span><span class="n">AddUint64</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span><span class="n">Counter</span><span class="p">)</span> <span class="n">Value</span><span class="p">()</span> <span class="kt">uint64</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">atomic</span><span class="o">.</span><span class="n">LoadUint64</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">xAddr</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Now we need to change CommonBenchmarkRunner to use our Counter instead of
<code class="language-plaintext highlighter-rouge">uint64</code> for the <code class="language-plaintext highlighter-rouge">metricCnt</code> and <code class="language-plaintext highlighter-rouge">rowCnt</code>.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code> // CommonBenchmarkRunner is responsible for initializing and storing common
 // flags across all database systems and ultimately running a supplied Benchmark
 type CommonBenchmarkRunner struct {
        BenchmarkRunnerConfig
<span class="gd">-       metricCnt      uint64
-       rowCnt         uint64
</span><span class="gi">+       metricCnt      Counter
+       rowCnt         Counter
</span>        initialRand    *rand.Rand
        sleepRegulator insertstrategy.SleepRegulator
 }
</code></pre></div></div>

<p>Later, in the call, we use the <code class="language-plaintext highlighter-rouge">.Add</code> method that do the bit alignment between
the 32 and 64 bits parity:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code> @@ -245,8 +267,8 @@ func (l *CommonBenchmarkRunner) work(b targets.Benchmark, wg *sync.WaitGroup, c
        for batch := range c.toWorker {
                startedWorkAt := time.Now()
                metricCnt, rowCnt := proc.ProcessBatch(batch, l.DoLoad)
<span class="gd">-               atomic.AddUint64(&amp;l.metricCnt, metricCnt)
-               atomic.AddUint64(&amp;l.rowCnt, rowCnt)
</span><span class="gi">+               l.metricCnt.Add(metricCnt)
+               l.rowCnt.Add(rowCnt)
</span>                c.sendToScanner()
                l.timeToSleep(workerNum, startedWorkAt)
</code></pre></div></div>

<p>And, then we just need to use <code class="language-plaintext highlighter-rouge">.Value()</code> to rescue the uint64 value again.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@@ -268,12 +290,12 @@</span> func (l *CommonBenchmarkRunner) timeToSleep(workerNum uint, startedWorkAt time.T
<span class="err">
</span> // summary prints the summary of statistics from loading
 func (l *CommonBenchmarkRunner) summary(took time.Duration) {
<span class="gd">-       metricRate := float64(l.metricCnt) / took.Seconds()
</span><span class="gi">+       metricRate := float64(l.metricCnt.Value()) / took.Seconds()
</span>        printFn("\nSummary:\n")
<span class="gd">-       printFn("loaded %d metrics in %0.3fsec with %d workers (mean rate %0.2f metrics/sec)\n", l.metricCnt, took.Seconds(), l.Workers, metricRate)
-       if l.rowCnt &gt; 0 {
-               rowRate := float64(l.rowCnt) / float64(took.Seconds())
-               printFn("loaded %d rows in %0.3fsec with %d workers (mean rate %0.2f rows/sec)\n", l.rowCnt, took.Seconds(), l.Workers, rowRate)
</span><span class="gi">+       printFn("loaded %d metrics in %0.3fsec with %d workers (mean rate %0.2f metrics/sec)\n", l.metricCnt.Value(), took.Seconds(), l.Workers, metricRate)
+       if l.rowCnt.Value() &gt; 0 {
+               rowRate := float64(l.rowCnt.Value()) / float64(took.Seconds())
+               printFn("loaded %d rows in %0.3fsec with %d workers (mean rate %0.2f rows/sec)\n", l.rowCnt.Value(), took.Seconds(), l.Workers, rowRate)
</span>        }
 }
</code></pre></div></div>

<p>Now, after compiling it again, it’s time to see it in action.</p>

<h2 id="tsbs_load-results">tsbs_load results</h2>

<p>First thing to remind here is that I’m going to do a few tests scenarios here:</p>

<ol>
  <li>Run tsbs and PostgreSQL inside the same Raspberry PI</li>
  <li>Run tsbs from my Macbook and PostgreSQL on Raspberry PI using my local
network</li>
</ol>

<h3 id="running-tsbs-directly-inside-the-raspberry-pi">Running TSBS directly inside the Raspberry PI</h3>

<p>In the Raspberry PI console, go to <code class="language-plaintext highlighter-rouge">tsbs</code> folder and run:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/tsbs_load load timescaledb --config config.yaml

Using config file: config.yaml
time,per. metric/s,metric total,overall metric/s,per. row/s,row total,overall row/s
1621732292,119996.91,1.200000E+06,119996.91,11999.69,1.200000E+05,11999.69
1621732302,120001.86,2.400000E+06,119999.39,12000.19,2.400000E+05,11999.94
1621732312,139997.19,3.800000E+06,126665.39,13999.72,3.800000E+05,12666.54
1621732322,139998.06,5.200000E+06,129998.57,13999.81,5.200000E+05,12999.86
1621732332,129821.72,6.500000E+06,129963.16,12982.17,6.500000E+05,12996.32
1621732342,120168.22,7.700000E+06,128332.96,12016.82,7.700000E+05,12833.30
1621732352,119854.13,8.900000E+06,127120.44,11985.41,8.900000E+05,12712.04

Summary:
loaded 9999990 metrics in 79.997sec with 2 workers (mean rate 125004.61 metrics/sec)
loaded 999999 rows in 79.997sec with 2 workers (mean rate 12500.46 rows/sec)
</code></pre></div></div>

<p>Not bad! 1M rows in 80 seconds!</p>

<h3 id="running-tsbs-from-an-external-machine">Running tsbs from an external machine</h3>

<p>Let’s try to move to outside of the Raspberry PI just to not have
the overload of <code class="language-plaintext highlighter-rouge">tsbs_load</code> and configure it to insert in my Raspberry PI
from my local network.</p>

<p>Sharing a bit of my setup, I’m running it from my Macbook that is connected via
wi-fi to a modem and the Raspberry PI is connected via cable in the modem.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scp -r jonatas@rpi-cable:~/go/src/github.com/timescale/tsbs/config.yaml ./
</code></pre></div></div>

<p>Now I’ll change the <code class="language-plaintext highlighter-rouge">host</code> from <code class="language-plaintext highlighter-rouge">0.0.0.0</code> to <code class="language-plaintext highlighter-rouge">rpi-cable</code> that is mapping the
actual IP via <code class="language-plaintext highlighter-rouge">/etc/hosts</code>.</p>

<p>Also change the <code class="language-plaintext highlighter-rouge">config.yaml</code> file host to the <code class="language-plaintext highlighter-rouge">rpi-cable</code> name.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">host</span><span class="pi">:</span> <span class="s">rpi-cable</span>
</code></pre></div></div>

<p>Running:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/tsbs_load load timescaledb --config /tmp/config.yaml
Using config file: /tmp/config.yaml
time,per. metric/s,metric total,overall metric/s,per. row/s,row total,overall row/s
1621733399,129933.24,1.300000E+06,129933.24,12993.32,1.300000E+05,12993.32
1621733409,230105.42,3.600000E+06,179994.99,23010.54,3.600000E+05,17999.50
1621733419,210010.39,5.700000E+06,189999.61,21001.04,5.700000E+05,18999.96
1621733429,209999.13,7.800000E+06,194999.50,20999.91,7.800000E+05,19499.95

Summary:
loaded 9999990 metrics in 48.649sec with 4 workers (mean rate 205553.49 metrics/sec)
loaded 999999 rows in 48.649sec with 4 workers (mean rate 20555.35 rows/sec)
</code></pre></div></div>

<p>Much better! 1M rows in 48 seconds!</p>

<p>When we do benchmarks at Timescale, we generally setup two machines in the cloud
to guarantee we’ll not have interference of any process and have only the main
Postgres process running. As I’m just having fun in the weekend, I was curious
about understanding the load of <code class="language-plaintext highlighter-rouge">tsbs</code> and the interference in a small hardware.</p>

<p>In this case the interference is pretty clear, getting 60% more performance
after removing the competition between tsbs and the PostgreSQL working on
loading the data.</p>

<h2 id="tsbs_queries-results">tsbs_queries results</h2>

<p>Trying to run tsbs queries from the Raspberry will force me to change all the
code to work with the new counter and I see it will not be a good idea, so
let’s run only from the outside, which seems closer to a real server scenario.</p>

<p>I love to use the <a href="https://github.com/timescale/tsbs/blob/master/scripts/full_cycle_minitest/full_cycle_minitest_timescaledb.sh">full_minicycle_timescaledb</a>
script that is the shortest path to have a full scenario of loading + using several queries over the DB.</p>

<p>Here is the command to run:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>env HOST=rpi-cable PASSWORD=password ./full_cycle_minitest_timescaledb.sh
</code></pre></div></div>
<p>I hacked the first line of the bash script to be <code class="language-plaintext highlighter-rouge">bash -x</code> to expose all commands used in the script. So, first, it generates a lot of data:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+ mkdir -p /tmp/bulk_data
+ tsbs_generate_data --format timescaledb --use-case cpu-only --scale 4 --seed 123 --file /tmp/bulk_data/timescaledb_data
+ tsbs_generate_queries --queries=1000 --format timescaledb --use-case cpu-only --scale 4 --seed 123 --query-type lastpoint --file /tmp/bulk_data/timescaledb_query_lastpoint
TimescaleDB last row per host: 1000 points
+ tsbs_generate_queries --queries=1000 --format timescaledb --use-case cpu-only --scale 4 --seed 123 --query-type cpu-max-all-1 --file /tmp/bulk_data/timescaledb_query_cpu-max-all-1
TimescaleDB max of all CPU metrics, random    1 hosts, random 8h0m0s by 1h: 1000 points
+ tsbs_generate_queries --queries=1000 --format timescaledb --use-case cpu-only --scale 4 --seed 123 --query-type high-cpu-1 --file /tmp/bulk_data/timescaledb_query_high-cpu-1
TimescaleDB CPU over threshold, 1 host(s): 1000 points
</code></pre></div></div>

<p>The next step loads a short amount of metrics to test the inserts as we did before with the <code class="language-plaintext highlighter-rouge">tsbs_load</code> command, but using the YAML config. It also accepts command line parameters:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+ tsbs_load_timescaledb --pass=password '--postgres=sslmode=disable port=5432' --db-name=benchmark --host=rpi-cable --user=postgres --workers=1 --file=/tmp/bulk_data/timescaledb_data
time,per. metric/s,metric total,overall metric/s,per. row/s,row total,overall row/s

Summary:
loaded 345600 metrics in 5.844sec with 1 workers (mean rate 59134.26 metrics/sec)
loaded 34560 rows in 5.844sec with 1 workers (mean rate 5913.43 rows/sec)
</code></pre></div></div>

<p>And then it starts loading the queries part with previously generated queries:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+ tsbs_run_queries_timescaledb --max-rps=0 --hdr-latencies=0rps_timescaledb_query_lastpoint.hdr --pass=password '--postgres=sslmode=disable port=5432' --db-name=benchmark --hosts=rpi-cable --user=postgres --workers=1 --max-queries=1000 --file=/tmp/bulk_data/timescaledb_query_lastpoint
After 100 queries with 1 workers:
Interval query rate: 62.68 queries/sec	Overall query rate: 62.68 queries/sec
TimescaleDB last row per host:
min:     5.10ms, med:     6.51ms, mean:    15.93ms, max:  209.67ms, stddev:    24.06ms, sum:   1.6sec, count: 100
all queries                  :
min:     5.10ms, med:     6.51ms, mean:    15.93ms, max:  209.67ms, stddev:    24.06ms, sum:   1.6sec, count: 100
...
Run complete after 1000 queries with 1 workers (Overall query rate 61.99 queries/sec):
TimescaleDB last row per host:
min:     4.42ms, med:     6.75ms, mean:    16.05ms, max:  209.67ms, stddev:    17.46ms, sum:  16.1sec, count: 1000
all queries                  :
min:     4.42ms, med:     6.75ms, mean:    16.05ms, max:  209.67ms, stddev:    17.46ms, sum:  16.1sec, count: 1000
Saving High Dynamic Range (HDR) Histogram of Response Latencies to 0rps_timescaledb_query_lastpoint.hdr
wall clock time: 16.185718sec
+tsbs_run_queries_timescaledb --max-rps=0 --hdr-latencies=0rps_timescaledb_query_cpu-max-all-1.hdr --pass=password '--postgres=sslmode=disable port=5432' --db-name=benchmark --hosts=rpi-cable --user=postgres --workers=1 --max-queries=1000 --file=/tmp/bulk_data/timescaledb_query_cpu-max-all-1
After 100 queries with 1 workers:
</code></pre></div></div>

<p>Note the second line in this previous output:</p>

<p><strong>TimescaleDB last row per host:</strong></p>

<p>So, the <a href="https://github.com/timescale/tsbs/blob/1ac5e93c6758979e5a25de92eaafddc0c4612e5b/cmd/tsbs_generate_queries/databases/timescaledb/devops.go#L218-L231">query</a> is checking something like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT DISTINCT ON (hostname) * FROM CPU ORDER BY hostname, time DESC
</code></pre></div></div>

<p>Continuing to the following query:</p>

<p><strong>TimescaleDB max of all CPU metrics, random    1 hosts, random 8h0m0s by 1h:</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Interval query rate: 12.76 queries/sec	Overall query rate: 12.76 queries/sec
TimescaleDB max of all CPU metrics, random    1 hosts, random 8h0m0s by 1h:
min:    47.42ms, med:    71.53ms, mean:    78.32ms, max:  186.71ms, stddev:    27.65ms, sum:   7.8sec, count: 100
...
Run complete after 1000 queries with 1 workers (Overall query rate 12.09 queries/sec):
TimescaleDB max of all CPU metrics, random    1 hosts, random 8h0m0s by 1h:
min:    44.31ms, med:    78.26ms, mean:    82.71ms, max:  836.25ms, stddev:    38.17ms, sum:  82.7sec, count: 1000
wall clock time: 82.804588sec
</code></pre></div></div>

<p><strong>TimescaleDB CPU over threshold, 1 host(s):</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+ tsbs_run_queries_timescaledb --max-rps=0 --hdr-latencies=0rps_timescaledb_query_high-cpu-1.hdr --pass=password '--postgres=sslmode=disable port=5432' --db-name=benchmark --hosts=rpi-cable --user=postgres --workers=1 --max-queries=1000 --file=/tmp/bulk_data/timescaledb_query_high-cpu-1
After 100 queries with 1 workers:
Interval query rate: 11.28 queries/sec	Overall query rate: 11.28 queries/sec
TimescaleDB CPU over threshold, 1 host(s):
min:    23.80ms, med:    84.60ms, mean:    88.61ms, max:  235.81ms, stddev:    41.83ms, sum:   8.9sec, count: 100
...
After 400 queries with 1 workers:
Run complete after 1000 queries with 1 workers (Overall query rate 15.51 queries/sec):
TimescaleDB CPU over threshold, 1 host(s):
min:    21.90ms, med:    57.68ms, mean:    64.47ms, max:  942.30ms, stddev:    40.32ms, sum:  64.5sec, count: 1000
Saving High Dynamic Range (HDR) Histogram of Response Latencies to 0rps_timescaledb_query_high-cpu-1.hdr
wall clock time: 64.562662sec
</code></pre></div></div>

<p>As we can see, a simple Raspberry Pi can give us some good insights into how powerful is TimescaleDB even running on small hardware.</p>

<p>Just kidding, this is just my initial attempts with low a small set to see how
small and accessible hardware can be working with all these great technologies.</p>

<p>The speed seems to be reasonably good to 4 cores of 1.2Ghz and 1GB of RAM.</p>

<p>That’s all for Saturday night hacking! Thanks for reading 🤗</p>


  </div>
  
  
  <div class="article-tags">
    
  </div>
  
  
  
<div class="social-sharing mb-4">
  <h5>Share this article</h5>
  <div class="sharing-buttons">
    
    <a href="https://twitter.com/intent/tweet?text=Time+Series+Benchmark+Timescaledb+Raspberry+Pi&url=https%3A%2F%2Fideia.me%2Ftime-series-benchmark-timescaledb-raspberry-pi&via=jonatasdp" 
       class="btn btn-twitter btn-sm" 
       target="_blank"
       rel="noopener noreferrer">
      <i class="bi bi-twitter"></i> Twitter
    </a>
    
    
    
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fideia.me%2Ftime-series-benchmark-timescaledb-raspberry-pi" 
       class="btn btn-facebook btn-sm" 
       target="_blank"
       rel="noopener noreferrer">
      <i class="bi bi-facebook"></i> Facebook
    </a>
    
    
    
    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fideia.me%2Ftime-series-benchmark-timescaledb-raspberry-pi&title=Time+Series+Benchmark+Timescaledb+Raspberry+Pi" 
       class="btn btn-linkedin btn-sm" 
       target="_blank"
       rel="noopener noreferrer">
      <i class="bi bi-linkedin"></i> LinkedIn
    </a>
    
    
    
    <a href="https://reddit.com/submit?url=https%3A%2F%2Fideia.me%2Ftime-series-benchmark-timescaledb-raspberry-pi&title=Time+Series+Benchmark+Timescaledb+Raspberry+Pi" 
       class="btn btn-reddit btn-sm" 
       target="_blank"
       rel="noopener noreferrer">
      <i class="bi bi-reddit"></i> Reddit
    </a>
    
  </div>
</div>
 
  <div class="author-bio">
  <img src="/images/jonatas-davi-paganini-profile-2025.png" alt="Jônatas Davi Paganini">
  <div class="author-bio-content">
    <h4>Jônatas Davi Paganini</h4>
    <p>Developer and writer passionate about PostgreSQL, TimescaleDB, and building better systems. Currently sharing knowledge about time series databases and system architecture.</p>
    <div class="author-social">
      <a href="https://github.com/jonatas" target="_blank" title="GitHub"><i class="bi bi-github"></i></a>
      <a href="https://twitter.com/jonatasdp" target="_blank" title="Twitter"><i class="bi bi-twitter"></i></a>
      <a href="https://linkedin.com/in/jonatasdp" target="_blank" title="LinkedIn"><i class="bi bi-linkedin"></i></a>
      
      <a href="https://instagram.com/jonatasdp" target="_blank" title="Instagram"><i class="bi bi-instagram"></i></a>
      
    </div>
  </div>
</div> 
  <div class="content-nav">
  <div class="content-nav-previous">
    
      <small>Previous</small>
      <a href="/ssh-connection-refused" title="SSH connection refused">
        SSH connection refused
      </a>
    
  </div>
  
  <div class="content-nav-next">
    
      <small>Next</small>
      <a href="/pgconfbr-talk" title="PGConf Brasil">
        PGConf Brasil
      </a>
    
  </div>
</div> 
  
<div class="related-posts">
  <div class="card">
    <div class="card-header">
      <h4>Related Articles</h4>
    </div>
    <div class="card-body">
      <div class="row">
        
        
        
        
        
          
            
              
              
                
              
                
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
                
              
                
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
                
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
                
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
                
              
                
              
              
              
            
          
          
          
        
          
            
              
              
                
              
                
              
                
              
              
              
            
          
          
          
            
        
        
        
        
        
        
        
          <div class="col-12">
            <p>No related posts found. Check out <a href="/archive.html">recent posts</a> instead.</p>
          </div>
        
      </div>
    </div>
  </div>
</div>
 
  
<div id="disqus_thread"></div>
<script>
  var disqus_config = function () {
    this.page.url = '/time-series-benchmark-timescaledb-raspberry-pi';
    this.page.identifier = '/time-series-benchmark-timescaledb-raspberry-pi';
  };

  (function() {
    var d = document, s = d.createElement('script');
    s.src = 'https://ideiame.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
 
</div>

<link rel="stylesheet" href="/css/enhanced.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">


    </div>
    
    <footer class="footer py-4 mt-5">
      <div class="container text-center">
        <p class="text-muted mb-0">© 2025 Jônatas Davi Paganini. All rights reserved.</p>
      </div>
    </footer>

    <!-- Consolidated JS -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Apply highlighting to code blocks after content loads
        if (typeof enhanceCodeBlocks === 'function') {
          enhanceCodeBlocks();
        }
        
        if (window.Prism) {
          setTimeout(function() {
            Prism.highlightAll();
          }, 100);
        }
        
        // Add fade-in animations
        const fadeElements = document.querySelectorAll('.fade-in');
        
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('visible');
            }
          });
        }, {
          threshold: 0.1
        });
        
        fadeElements.forEach(element => {
          observer.observe(element);
        });
        
        // Apply fade-in to cards and other elements
        const animateElements = document.querySelectorAll('.card:not(.latest-post-card):not(.post-content), .glass-card, .post-list-group .list-group-item');
        animateElements.forEach((element, index) => {
          element.classList.add('fade-in');
          element.style.transitionDelay = `${index * 0.02}s`; // Minimal delay
        });
        
        // Copy code button functionality
        const codeBlocks = document.querySelectorAll('pre');
        codeBlocks.forEach((block) => {
          if (!block.querySelector('.copy-button')) {
            const button = document.createElement('button');
            button.className = 'copy-button';
            button.textContent = 'Copy';
            
            button.addEventListener('click', () => {
              const code = block.querySelector('code').textContent;
              navigator.clipboard.writeText(code).then(() => {
                button.textContent = 'Copied!';
                button.classList.add('copied');
                
                setTimeout(() => {
                  button.textContent = 'Copy';
                  button.classList.remove('copied');
                }, 2000);
              });
            });
            
            block.appendChild(button);
          }
        });
        
        // Smooth page transitions
        const contentContainer = document.querySelector('.content-container');
        if (contentContainer) {
          // Set initial opacity
          contentContainer.style.opacity = '0';
          
          // Fade in the content
          setTimeout(() => {
            contentContainer.style.transition = 'opacity 0.3s ease';
            contentContainer.style.opacity = '1';
          }, 50);
        }
        
        // Handle page navigation transitions
        document.querySelectorAll('a').forEach(link => {
          // Only apply to internal links
          if (link.hostname === window.location.hostname && !link.hasAttribute('target')) {
            link.addEventListener('click', function(e) {
              // Don't apply to download links or anchor links
              if (link.hasAttribute('download') || link.getAttribute('href').startsWith('#')) {
                return;
              }
              
              e.preventDefault();
              const destination = link.href;
              
              // Fade out
              if (contentContainer) {
                contentContainer.style.opacity = '0';
              }
              
              // Navigate after a short delay
              setTimeout(() => {
                window.location.href = destination;
              }, 300);
            });
          }
        });
      });
    </script>
    
    <!-- Dedicated scripts -->
  </body>
</html>

