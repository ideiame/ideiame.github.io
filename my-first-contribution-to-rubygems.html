
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
<link rel="stylesheet"
    type="text/css"
    href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js"
    data-cfasync="false"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NV80WM9HT0"></script>
<script>
    // Reads the value of a cookie by name or returns empty string
    function getCookie(name) {
        var b = document.cookie.match('(^|[^;]+)\\s*' + name + '\\s*=\\s*([^;]+)');
        return b ? b.pop() : '';
    }

    // Actually starting analytics up
    function addAnalytics() {
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());
        gtag('config', 'G-NV80WM9HT0');
    }

    // Waiting for the load event
    window.addEventListener("load", function () {
        // Reading "cookieconsent_status" cookie
        const cookieConsent = getCookie('cookieconsent_status');

        // Start analytics if user consented or did not deny
        if (cookieConsent === 'allow' || cookieConsent === '') {
            addAnalytics();
        }

        // Initialise cookie consent banner
        window.cookieconsent.initialise({
            "palette": {
                "popup": {
                    "background": "#efefef",
                    "text": "#404040"
                },
                "button": {
                    "background": "#8ec760",
                    "text": "#ffffff"
                }
            },
            "type": "opt-out",
            "content": {
                "allow": "Approve",
                "dismiss": "Approve",
                "deny": "Reject"
            },
            // Reload the page on user choice to make sure cookie is set
            onStatusChange: function (status, chosenBefore) {
                location.reload();
            }
        })
    });
</script>

    <script async
src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1171230226237014"
crossorigin="anonymous"></script>

    <meta charset="utf-8">
    <title>My First Contribution To Rubygems</title>
    
    <meta name="author" content="Jônatas Davi Paganini">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link id="bootstrap" href="/css/bootstrap.css" rel="stylesheet">
    <link id="bootstrap" href="/css/bootswatch.min.css" rel="stylesheet">
    <link href="/css/nimbus-pygments.css" rel="stylesheet">

    <script src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/bootstrap-dropdown.js"></script>
    <div id="fb-root"></div>

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
  <script type="text/javascript" language="javascript" charset="utf-8">
// <![CDATA[
    addEventListener('load', function (event) {
      var agent=navigator.userAgent.toLowerCase();
      var links = document.getElementsByTagName('a');
      var regex = new RegExp('^'+window.location.protocol + '//' + window.location.hostname);

      for (var i = 0, linksLength = links.length; i < linksLength; i++) {
        if ( ! links[i].href.match(regex)) {
           links[i].setAttribute('target', '_blank');
       }
     }

    }, false);
// ]]>
</script>
</head>
<body>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v2.5&appId=138593009602387";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a href="/">
            <img class="img-circle" alt="ideiame logo" style="padding-top: 6px" src="/images/ideiame.png"></a>
            <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
           </button>
       </div>
   <div class="navbar-collapse collapse" id="navbar-main">
     <ul class="nav navbar-nav">
      <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Social<b class="caret"></b></a>
            <ul class="dropdown-menu" id="swatch-menu">
              <li><a href="https://github.com/jonatas">Github</a></li>
              <li><a href="https://twitter.com/jonatasdp">Twitter</a></li>
              <li><a href="https://instagram.com/jonatasdp">Instagram</a></li>
              <li><a href="https://www.meetup.com/Floripa-on-Rails/members/185190193/">Meetup</a></li>
              <li><a href="https://www.slideshare.net/jonataspaganini/">SlideShare</a></li>
              <li><a href="https://facebook.com/jonatas.paganini">Facebook</a></li>
              <li><a href="https://www.youtube.com/user/jonatasdp">Youtube</a></li>
           </ul>
          </li>
          <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Projects<b class="caret"></b></a>
            <ul class="dropdown-menu">
            <li><a href="https://github.com/jonatas/fast">Fast</a></li>
            <li><a href="http://torf.ideia.me">2015: True Or False Game</a></li>
            <li><a href="http://github.com/jonatas/pixel.ideia.me">2013: Pixel art (collaborative) </a></li>
            <li><a href="http://github.com/jonatas/trybliss">2013: Try Bliss</a</li>
            <li><a href="http://github.com/jonatas/churumelas">2012: Regexp challenges</a></li>
            <li><a href="/camera-overlay">2012: Camera Overlay </a></li>
           </ul>
          </li>
          
          
          


  
    
      
      	
      	<li><a href="/archive">Arquivo</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories">Categorias</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  



          </ul>
        </div>
      </div>
     </div>
    </div>
    <div class="container">
      
<div class="page-header">
    <h1>
       <img class="thumb img-circle" src="https://avatars0.githubusercontent.com/u/15484?s=50" title="Jônatas Davi Paganini" alt="Jônatas Davi Paganini profile pic"></img>
       My First Contribution To Rubygems <small><br/>04/07/2024
    
      <span class="categories">
        
          <a  class="btn btn-primary" href=/categories.html#time-series-ref>time-series
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
            <span class="badge">5</span>
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
          </a>
         
          <a  class="btn btn-primary" href=/categories.html#timescaledb-ref>timescaledb
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
            <span class="badge">3</span>
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
          </a>
         
          <a  class="btn btn-primary" href=/categories.html#opensource-ref>opensource
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
            <span class="badge">8</span>
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
          </a>
         
          <a  class="btn btn-primary" href=/categories.html#performance-ref>performance
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
            <span class="badge">2</span>
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
          </a>
         
          <a  class="btn btn-primary" href=/categories.html#ruby-ref>ruby
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
            <span class="badge">22</span>
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
          </a>
         
       </span>
     
     </small>
  </h1>
</div>
<div class="content">
    <p>Adding to my goal of being helpful in the software world, I had my first contribution to RubyGems
<a href="https://github.com/rubygems/rubygems.org/pull/4716">merged</a> 🎉</p>

<p>It effectively just adds <a href="https://rubygems.org/gems/timescaledb">timescaledb gem</a> to the RubyGems server and
it marks the beginning of a journey.</p>

<p>This merge is not just about adding the gem to the server, but also about opening
a commitment path to maintain the work and keep it up-to-date.</p>

<p>I created the <a href="https://rubygems.org/gems/timescaledb">timescaledb</a> gem to help Ruby developers interact with
TimescaleDB, a time-series database built on top of PostgreSQL. As I work as a
Developer Advocate at Timescale, I created the library but never used it in a
production case. Now, let’s take a look at what we have and what it will look like.</p>

<p>If you’re curious about the full example, check out the <a href="https://gist.github.com/jonatas/418f360d45c890e1d86c30547a0cf6a4">PoC of downloads</a> I made,
which parses a sample log file and builds the ingest pipeline to track and build
statistics around the downloads.</p>

<h2 id="how-are-downloads-tracked-today">How are downloads tracked today?</h2>

<p>The RubyGems dump is available for download. You can run it locally quite easily
to fetch <a href="https://rubygems.org/pages/data">latest data</a>.</p>

<p>The main model storing the gems is the <code class="language-plaintext highlighter-rouge">Rubygem</code> model. It has a <code class="language-plaintext highlighter-rouge">name</code> field
that tracks the name and is also unique. Let’s use <a href="https://rubygems.org/gems/ffast">ffast</a> as an example,
a gem that I created for another purpose.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rubygem</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"ffast"</span><span class="p">)</span>
  <span class="no">Rubygem</span> <span class="no">Load</span> <span class="p">(</span><span class="mf">53.9</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="s2">"rubygems"</span><span class="p">.</span><span class="nf">*</span> <span class="no">FROM</span> <span class="s2">"rubygems"</span> <span class="no">WHERE</span> <span class="s2">"rubygems"</span><span class="o">.</span><span class="s2">"name"</span> <span class="o">=</span> <span class="s1">'ffast'</span> <span class="no">LIMIT</span> <span class="mi">1</span>
<span class="o">=&gt;</span>
<span class="c1">#&lt;Rubygem:0x000000012b902fa0</span>
 <span class="ss">id: </span><span class="mi">162483</span><span class="p">,</span>
 <span class="ss">name: </span><span class="s2">"ffast"</span><span class="p">,</span>
 <span class="ss">created_at: </span><span class="no">Fri</span><span class="p">,</span> <span class="mo">07</span> <span class="no">Jul</span> <span class="mi">2017</span> <span class="mo">03</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mf">59.930836000</span> <span class="no">UTC</span> <span class="o">+</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">,</span>
 <span class="ss">updated_at: </span><span class="no">Fri</span><span class="p">,</span> <span class="mi">17</span> <span class="no">Nov</span> <span class="mi">2023</span> <span class="mi">22</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">13.843324000</span> <span class="no">UTC</span> <span class="o">+</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">,</span>
 <span class="ss">indexed: </span><span class="kp">true</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">gem_downloads</code> table stores the download counts for each gem and version.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rubygem</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"ffast"</span><span class="p">).</span><span class="nf">gem_download</span>
<span class="c1"># =&gt; #&lt;GemDownload:0x000000012ba18bb0 id: 1040717, rubygem_id: 162483, version_id: 0, count: 61240&gt;</span>
</code></pre></div></div>

<p>The version 0 is used to store the total number of downloads for a gem.
Let’s check the timescaledb gem downloads version by version:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">GemDownload</span><span class="p">.</span><span class="nf">where</span> <span class="ss">rubygem: </span><span class="no">Rubygem</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"timescaledb"</span><span class="p">)</span>
<span class="c1"># GemDownload Load (19.0ms)  SELECT "gem_downloads".* FROM "gem_downloads" WHERE "gem_downloads"."rubygem_id" IN (SELECT "rubygems"."id" FROM "rubygems" WHERE "rubygems"."name" = 'timescaledb') /* loading for pp */ LIMIT 11</span>
<span class="o">=&gt;</span>
<span class="p">[</span><span class="c1">#&lt;id: 1535560, rubygem_id: 202908, version_id: 1416878, count: 1888&gt;,</span>
 <span class="c1">#&lt;id: 1625766, rubygem_id: 202908, version_id: 1503257, count: 11117&gt;,</span>
 <span class="c1">#&lt;id: 1552678, rubygem_id: 202908, version_id: 1433205, count: 1156&gt;,</span>
 <span class="c1">#&lt;id: 1491839, rubygem_id: 202908, version_id: 1375481, count: 1359&gt;,</span>
 <span class="c1">#&lt;id: 1491667, rubygem_id: 202908, version_id: 1375327, count: 1229&gt;,</span>
 <span class="c1">#&lt;id: 1872196, rubygem_id: 202908, version_id: 1729060, count: 1198&gt;,</span>
 <span class="c1">#&lt;id: 1647372, rubygem_id: 202908, version_id: 1524050, count: 389&gt;,</span>
 <span class="c1">#&lt;id: 1488577, rubygem_id: 202908, version_id: 1372457, count: 1285&gt;,</span>
 <span class="c1">#&lt;id: 1622843, rubygem_id: 202908, version_id: 1500448, count: 484&gt;,</span>
 <span class="c1">#&lt;id: 1512167, rubygem_id: 202908, version_id: 1394533, count: 1274&gt;,</span>
 <span class="s2">"..."</span><span class="p">]</span>
</code></pre></div></div>

<p>You can also combine the counter version by version in a single query:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rubygem</span>
  <span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"timescaledb"</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">versions</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="ss">:gem_download</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">pluck</span> <span class="ss">:number</span><span class="p">,</span> <span class="ss">:count</span>

<span class="c1">#  Rubygem Load (4.0ms)  SELECT "rubygems".* FROM "rubygems" WHERE "rubygems"."name" = 'timescaledb' LIMIT 1</span>
<span class="c1">#  Version Pluck (4.8ms)  SELECT "versions"."number", "count" FROM "versions" LEFT OUTER JOIN "gem_downloads" ON "gem_downloads"."version_id" = "versions"."id" WHERE "versions"."rubygem_id" = 202908</span>
<span class="o">=&gt;</span>
<span class="p">[[</span><span class="s2">"0.1.0"</span><span class="p">,</span> <span class="mi">1285</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"0.1.2"</span><span class="p">,</span> <span class="mi">1266</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"0.1.3"</span><span class="p">,</span> <span class="mi">1229</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"0.1.4"</span><span class="p">,</span> <span class="mi">1359</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"0.1.5"</span><span class="p">,</span> <span class="mi">1274</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"0.2.0"</span><span class="p">,</span> <span class="mi">1888</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"0.2.1"</span><span class="p">,</span> <span class="mi">1156</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"0.2.2"</span><span class="p">,</span> <span class="mi">484</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"0.2.3"</span><span class="p">,</span> <span class="mi">11117</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"0.2.4"</span><span class="p">,</span> <span class="mi">389</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"0.2.5"</span><span class="p">,</span> <span class="mi">4265</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"0.2.6"</span><span class="p">,</span> <span class="mi">445</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"0.2.7"</span><span class="p">,</span> <span class="mi">24963</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"0.2.8"</span><span class="p">,</span> <span class="mi">1198</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"0.2.9"</span><span class="p">,</span> <span class="mi">1128</span><span class="p">]]</span>
</code></pre></div></div>

<p>And, probably as you’re learning and getting excited about the numbers, let’s watch the
amazing growth of the rails gem only on stable releases:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rubygem</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"rails"</span><span class="p">).</span><span class="nf">versions</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="ss">:gem_download</span><span class="p">).</span><span class="nf">where</span><span class="p">(</span><span class="s2">"number ~ '.0.0$'"</span><span class="p">).</span><span class="nf">pluck</span> <span class="ss">:number</span><span class="p">,</span> <span class="ss">:count</span>
  <span class="no">Rubygem</span> <span class="no">Load</span> <span class="p">(</span><span class="mf">4.0</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="s2">"rubygems"</span><span class="p">.</span><span class="nf">*</span> <span class="no">FROM</span> <span class="s2">"rubygems"</span> <span class="no">WHERE</span> <span class="s2">"rubygems"</span><span class="o">.</span><span class="s2">"name"</span> <span class="o">=</span> <span class="s1">'rails'</span> <span class="no">LIMIT</span> <span class="mi">1</span>
  <span class="no">Version</span> <span class="no">Pluck</span> <span class="p">(</span><span class="mf">8.7</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="s2">"versions"</span><span class="o">.</span><span class="s2">"number"</span><span class="p">,</span> <span class="s2">"count"</span> <span class="no">FROM</span> <span class="s2">"versions"</span> <span class="no">LEFT</span> <span class="no">OUTER</span> <span class="no">JOIN</span> <span class="s2">"gem_downloads"</span> <span class="no">ON</span> <span class="s2">"gem_downloads"</span><span class="o">.</span><span class="s2">"version_id"</span> <span class="o">=</span> <span class="s2">"versions"</span><span class="o">.</span><span class="s2">"id"</span> <span class="no">WHERE</span> <span class="s2">"versions"</span><span class="o">.</span><span class="s2">"rubygem_id"</span> <span class="o">=</span> <span class="mi">15494</span> <span class="no">AND</span> <span class="p">(</span><span class="n">number</span> <span class="o">~</span> <span class="s1">'.0.0$'</span><span class="p">)</span>
<span class="o">=&gt;</span>
<span class="p">[[</span><span class="s2">"0.10.0"</span><span class="p">,</span> <span class="mi">5424</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"1.0.0"</span><span class="p">,</span> <span class="mi">6887</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"2.0.0"</span><span class="p">,</span> <span class="mi">7113</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"3.0.0"</span><span class="p">,</span> <span class="mi">478487</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"4.0.0"</span><span class="p">,</span> <span class="mi">2682776</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"5.0.0"</span><span class="p">,</span> <span class="mi">1031696</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"6.0.0"</span><span class="p">,</span> <span class="mi">2244407</span><span class="p">],</span>
 <span class="p">[</span><span class="s2">"7.0.0"</span><span class="p">,</span> <span class="mi">298492</span><span class="p">]]</span>
</code></pre></div></div>

<p>As you can see almost 3M downloads on the Rails 4.0.0 version. It’s a huge number!</p>

<h2 id="how-the-downloads-are-tracked">How the downloads are tracked?</h2>

<p>Moving on, the download counts are updated by the <code class="language-plaintext highlighter-rouge">FastlyLogProcessor</code> job that
runs every 5 minutes. A new log file is generated every few minutes. The files
are around 2 MB and are stored in the S3 bucket. I don’t have access to the logs
yet, but a core tem member gave me a sample anonymized log to work on the PoC.</p>

<p>The job reads the logs from the S3 bucket and processes the logs to update the
download counts.</p>

<p>The <a href="https://github.com/rubygems/rubygems.org/blob/6e919e3cc077abde5553b19afe6efbdcb04e106a/app/jobs/fastly_log_processor.rb#L44-L67">download_counts</a> method is the log processor that sums the number
of downloads per gem per day and update the counters.</p>

<p>Then, the <code class="language-plaintext highlighter-rouge">GemDownload</code> model is used to store the download counts for each gem
and version.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">counts</span> <span class="o">=</span> <span class="n">download_counts</span><span class="p">(</span><span class="n">log_ticket</span><span class="p">)</span>
  <span class="c1"># ...</span>

  <span class="n">processed_count</span> <span class="o">=</span> <span class="n">counts</span><span class="p">.</span><span class="nf">sum</span> <span class="p">{</span> <span class="o">|</span><span class="n">_</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span> <span class="n">v</span> <span class="p">}</span>
  <span class="no">GemDownload</span><span class="p">.</span><span class="nf">for_all_gems</span><span class="p">.</span><span class="nf">with_lock</span> <span class="k">do</span>
    <span class="no">GemDownload</span><span class="p">.</span><span class="nf">bulk_update</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>To track the overall number of downloads per gem, the <code class="language-plaintext highlighter-rouge">GemDownload</code> accumulate them
all in the version 0 as a way to track the total number of downloads for a gem.</p>

<h2 id="how-will-it-looks-like">How will it looks like?</h2>

<p>Downloads are events, and events are time-series data. The data is stored in a
relational database, but it’s not optimized for time-series data. The actual
data is only the final counters being incremented every 5 minutes.</p>

<p>With the <a href="https://github.com/timescale/timescaledb">timescaledb extension</a>, we can store the raw data as events and build
materialized views to track the downloads per gem, version, and day.</p>

<p>The <code class="language-plaintext highlighter-rouge">timescaledb</code> extension will help ingest the data into the database and build
the materialized views to track the downloads.</p>

<h2 id="advantages-of-using-timescaledb">Advantages of using TimescaleDB</h2>

<p>While the actual solution is very lean and works well, it’s not optimized for
timeseries data. It’s not exploring the full potential of the data because of the
way the data is being saved.</p>

<p>Timeseries data is about events that happen over time. The data is stored in
a way that allows querying and aggregating data efficiently. It allows you to
understand user behavior and track the growth of downloads, the rush hours,
and the most popular gems.</p>

<p>We’ll also be able to detect anomalies and build a dashboard to track the downloads
in real time.</p>

<p>The main advantage of using TimescaleDB is that it’s PostgreSQL. You just speak
SQL, and that’s it. You can use the same tools and libraries you’re used to.</p>

<p>Now, let’s break down the PoC and build the ingest pipeline to track and build
statistics around the downloads.</p>

<p>Let’s start with the plain logs we have:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;134&gt;2024-04-26T00:10:54Z cache-pao-kpao1770049 downloads[262515]: 1.2.3.4 Fri, 26 Apr 2024 00:10:54 GMT /gems/racc-1.7.3-java.gem 200 bundler/2.5.9 rubygems/3.3.25 ruby/3.1.0 (x86_64-Eclipse Adoptium-linux) command/install jruby/1.2.3.4 options/jobs,no_install,path ci/ci,github 47244d1623b8b050
&lt;134&gt;2024-04-26T00:10:54Z cache-iad-kiad7000157 downloads[262515]: 1.2.3.4 Fri, 26 Apr 2024 00:10:54 GMT /gems/aws-sdk-core-3.193.0.gem 200 Ruby, RubyGems/3.1.4 x86_64-linux Ruby/2.7.2 (2020-10-01 patchlevel 137)
&lt;134&gt;2024-04-26T00:10:54Z cache-pao-kpao1770049 downloads[262515]: 1.2.3.4 Fri, 26 Apr 2024 00:10:54 GMT /gems/regexp_parser-2.9.0.gem 200 bundler/2.5.9 rubygems/3.3.25 ruby/3.1.0 (x86_64-Eclipse Adoptium-linux) command/install jruby/1.2.3.4 options/jobs,no_install,path ci/ci,github 47244d1623b8b050
&lt;134&gt;2024-04-26T00:10:54Z cache-iad-kiad7000022 downloads[262515]: 1.2.3.4 Fri, 26 Apr 2024 00:10:54 GMT /gems/debase-ruby_core_source-3.3.1.gem 200 Ruby, RubyGems/3.4.1 x86_64-linux Ruby/2.6.10 (2022-04-12 patchlevel 210)
&lt;134&gt;2024-04-26T00:10:54Z cache-iad-kjyo7100141 downloads[262515]: 1.2.3.4 Fri, 26 Apr 2024 00:10:54 GMT /gems/apollo_upload_server-2.1.5.gem 200 Ruby, RubyGems/3.4.4 x86_64-linux Ruby/3.1.4 (2023-03-30 patchlevel 223)
&lt;134&gt;2024-04-26T00:10:54Z cache-chi-klot8100092 downloads[262515]: 1.2.3.4 Fri, 26 Apr 2024 00:10:54 GMT /gems/database_cleaner-core-2.0.1.gem 200 bundler/2.5.9 rubygems/3.4.4 ruby/3.0.6 (x86_64-pc-linux) command/install options/no_install,path 8d319b4f02ec22c1
&lt;134&gt;2024-04-26T00:10:54Z cache-iad-kiad7000088 downloads[262515]: 1.2.3.4 Fri, 26 Apr 2024 00:10:54 GMT /gems/unicode-display_width-2.5.0.gem 200 Ruby, RubyGems/3.1.6 x86_64-linux Ruby/2.7.8 (2023-03-30 patchlevel 225)
&lt;134&gt;2024-04-26T00:10:54Z 2024-04-26T00:10:54.586614839+00:00 downloads[262515]: 1.2.3.4 Fri, 26 Apr 2024 00:10:54 GMT /gems/tomlrb-2.0.3.gem 200 bundler/2.5.9 rubygems/3.5.3 ruby/3.3.0 (x86_64-pc-linux) command/install options/app_config,ignore_messages,no_install,rubygems.pkg.github.com,silence_root_warning 4d2c9a175ea7b626
&lt;134&gt;2024-04-26T00:10:54Z cache-iad-kcgs7200148 downloads[262515]: 1.2.3.4 Fri, 26 Apr 2024 00:10:54 GMT /gems/rspec-its-1.3.0.gem 200 Ruby, RubyGems/3.1.0 x86_64-linux Ruby/2.5.7 (2019-10-01 patchlevel 206)
&lt;134&gt;2024-04-26T00:10:54Z cache-iad-kcgs7200148 downloads[262515]: 1.2.3.4 Fri, 26 Apr 2024 00:10:54 GMT /gems/rspec-mocks-3.13.0.gem 200 Ruby, RubyGems/3.1.0 x86_64-linux Ruby/2.5.7 (2019-10-01 patchlevel 206)
</code></pre></div></div>

<p>Now, let’s parse this info:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">parse_file</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
  <span class="n">downloads</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">file</span><span class="p">).</span><span class="nf">each_line</span> <span class="k">do</span> <span class="o">|</span><span class="n">log_line</span><span class="o">|</span>
    <span class="n">fragments</span> <span class="o">=</span> <span class="n">log_line</span><span class="p">.</span><span class="nf">split</span>
    <span class="n">path</span><span class="p">,</span> <span class="n">response_code</span> <span class="o">=</span> <span class="n">fragments</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">case</span> <span class="n">response_code</span><span class="p">.</span><span class="nf">to_i</span>
      <span class="c1"># Only count successful downloads</span>
      <span class="c1"># NB: we consider a 304 response a download attempt</span>
    <span class="k">when</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">304</span>
      <span class="n">m</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="no">PATH_PATTERN</span><span class="p">)</span>
      <span class="n">gem_name</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="ss">:gem_name</span><span class="p">]</span> <span class="o">||</span> <span class="n">path</span>
      <span class="n">gem_version</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="ss">:gem_version</span><span class="p">]</span>
      <span class="c1"># ip = fragments[3]</span>
      <span class="n">ts</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">parse</span> <span class="n">fragments</span><span class="p">[</span><span class="mi">4</span><span class="o">..</span><span class="mi">9</span><span class="p">].</span><span class="nf">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
      <span class="n">env</span> <span class="o">=</span> <span class="n">parse_env</span> <span class="n">fragments</span><span class="p">[</span><span class="mi">12</span><span class="o">..-</span><span class="mi">1</span><span class="p">]</span>

      <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="n">env</span><span class="p">:}</span>

      <span class="n">downloads</span> <span class="o">&lt;&lt;</span> <span class="p">{</span><span class="n">ts</span><span class="p">:,</span> <span class="n">gem_name</span><span class="p">:,</span> <span class="n">gem_version</span><span class="p">:,</span> <span class="n">payload</span><span class="p">:}</span>
      <span class="k">if</span> <span class="n">downloads</span><span class="p">.</span><span class="nf">size</span> <span class="o">==</span> <span class="mi">5000</span>
        <span class="n">insert_downloads</span><span class="p">(</span><span class="n">downloads</span><span class="p">)</span>
        <span class="n">downloads</span><span class="p">.</span><span class="nf">clear</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">if</span> <span class="n">downloads</span><span class="p">.</span><span class="nf">any?</span>
    <span class="n">insert_downloads</span><span class="p">(</span><span class="n">downloads</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>As you can see, we hardcoded 5k batches to insert the data. This is a good practice
to avoid memory issues and to keep the data flowing.</p>

<p>For inserting the data, we can use the <code class="language-plaintext highlighter-rouge">timescaledb</code> along with the <code class="language-plaintext highlighter-rouge">bulk_insert</code>
to insert the data in batches.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">insert_downloads</span><span class="p">(</span><span class="n">downloads</span><span class="p">)</span>
  <span class="no">Download</span><span class="p">.</span><span class="nf">bulk_insert</span> <span class="ss">values: </span><span class="n">downloads</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">Download</code> model is a simple ActiveRecord model that maps the <code class="language-plaintext highlighter-rouge">downloads</code> table
which is also a simple table with the columns <code class="language-plaintext highlighter-rouge">ts</code>, <code class="language-plaintext highlighter-rouge">gem_name</code>, <code class="language-plaintext highlighter-rouge">gem_version</code>, and
<code class="language-plaintext highlighter-rouge">payload</code>.</p>

<p>So, you can imagine a migration with the following content:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">hypertable_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="ss">time_column: </span><span class="s1">'ts'</span><span class="p">,</span>
    <span class="ss">chunk_time_interval: </span><span class="s1">'1 day'</span><span class="p">,</span>
    <span class="ss">compress_segmentby: </span><span class="s1">'gem_name, gem_version'</span><span class="p">,</span>
    <span class="ss">compress_orderby: </span><span class="s1">'ts DESC'</span><span class="p">,</span>
    <span class="ss">compression_interval: </span><span class="s1">'7 days'</span>
  <span class="p">}</span>

  <span class="n">create_table</span><span class="p">(</span><span class="ss">:downloads</span><span class="p">,</span> <span class="ss">id: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">hypertable: </span><span class="n">hypertable_options</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">timestamptz</span> <span class="ss">:ts</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="ss">:gem_name</span><span class="p">,</span> <span class="ss">:gem_version</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
    <span class="n">t</span><span class="p">.</span><span class="nf">jsonb</span> <span class="ss">:payload</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>Then you can build the materialized views to track the downloads per gem, version,
and day. Now, let’s build the materialized views to track the downloads per gem.</p>

<p>Interestingly, there are quite a few hierarchical continuous aggregates, and I
believe it’s a good idea to keep them in a separate migration.</p>

<p>Now, let me try to break down all the cyclomatic complexity and build a simple
model to track the downloads per gem, version, and day.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Download</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">acts_as_hypertable</span> <span class="ss">time_column: </span><span class="s1">'ts'</span>

  <span class="n">scope</span> <span class="ss">:time_bucket</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">range</span><span class="o">=</span><span class="s1">'1m'</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s2">"count(*)"</span><span class="p">)</span> <span class="k">do</span>
    <span class="nb">select</span><span class="p">(</span><span class="s2">"time_bucket('</span><span class="si">#{</span><span class="n">range</span><span class="si">}</span><span class="s2">', </span><span class="si">#{</span><span class="n">time_column</span><span class="si">}</span><span class="s2">) as </span><span class="si">#{</span><span class="n">time_column</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">query</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">scope</span> <span class="ss">:per_minute</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">"count(*) as downloads"</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">time_bucket</span><span class="p">(</span><span class="s1">'1m'</span><span class="p">,</span> <span class="n">query</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">scope</span> <span class="ss">:gems_per_minute</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="k">do</span>
    <span class="n">per_minute</span><span class="p">(</span><span class="s2">"gem_name, count(*) as downloads"</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">scope</span> <span class="ss">:versions_per_minute</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="k">do</span>
    <span class="n">per_minute</span><span class="p">(</span><span class="s2">"gem_name, gem_version, count(*) as downloads"</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="o">...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Now, think about rolling up these statistics per hour, day, week, month, and year.</p>

<p>I believe it’s a good idea to keep them in a separate module and use the <code class="language-plaintext highlighter-rouge">cagg</code>
as a factory to build the models for each view.</p>

<p>This way, you can keep the code for each continuous aggregate in a separate
module but nested to the hypertable model, which I think is a good convention.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">cagg</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">view_name</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Class</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">)</span> <span class="k">do</span>
      <span class="nb">self</span><span class="p">.</span><span class="nf">table_name</span> <span class="o">=</span> <span class="s2">"downloads_</span><span class="si">#{</span><span class="n">view_name</span><span class="si">}</span><span class="s2">"</span>

      <span class="no">QUERIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="ss">sum_downloads: </span><span class="s2">"sum(downloads)::bigint as downloads"</span><span class="p">,</span>
        <span class="ss">avg_downloads: </span><span class="s2">"avg(downloads)::bigint as avg_downloads"</span>
      <span class="p">}</span>

      <span class="n">scope</span> <span class="ss">:rollup</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">range</span><span class="o">=</span><span class="s1">'1d'</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="ss">:sum_downloads</span><span class="p">)</span> <span class="k">do</span>
        <span class="nb">select</span><span class="p">(</span><span class="s2">"time_bucket('</span><span class="si">#{</span><span class="n">range</span><span class="si">}</span><span class="s2">', ts) as ts, </span><span class="si">#{</span><span class="no">QUERIES</span><span class="p">[</span><span class="n">query</span><span class="p">]</span> <span class="o">||</span> <span class="n">query</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
          <span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">scope</span> <span class="ss">:per_hour</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="ss">:sum_downloads</span><span class="p">)</span> <span class="k">do</span>
        <span class="n">rollup</span><span class="p">(</span><span class="s1">'1h'</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">scope</span> <span class="ss">:per_day</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="ss">:sum_downloads</span><span class="p">)</span> <span class="k">do</span>
        <span class="n">rollup</span><span class="p">(</span><span class="s1">'1d'</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">scope</span> <span class="ss">:per_week</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="ss">:sum_downloads</span><span class="p">)</span> <span class="k">do</span>
        <span class="n">rollup</span><span class="p">(</span><span class="s1">'1w'</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">scope</span> <span class="ss">:per_month</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="ss">:sum_downloads</span><span class="p">)</span> <span class="k">do</span>
        <span class="n">rollup</span><span class="p">(</span><span class="s1">'1mon'</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">scope</span> <span class="ss">:per_year</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="ss">:sum_downloads</span><span class="p">)</span> <span class="k">do</span>
        <span class="n">rollup</span><span class="p">(</span><span class="s1">'1y'</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">readonly?</span>
        <span class="kp">true</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">refresh!</span>
        <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">connection</span><span class="p">.</span><span class="nf">execute</span> <span class="o">&lt;&lt;-</span><span class="no">SQL</span><span class="sh">
        CALL refresh_continuous_aggregate('</span><span class="si">#{</span><span class="n">table_name</span><span class="si">}</span><span class="sh">', null, null);  
</span><span class="no">        SQL</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>In the end, you can use the <code class="language-plaintext highlighter-rouge">cagg</code> to build the models for each continuous aggregate
and keep the code clean and organized.</p>

<p>In this way, we keep the most important metadata in the code and then
make it easy to build the materialized views and keep them up-to-date.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="no">PerMinute</span> <span class="o">=</span> <span class="n">cagg</span><span class="p">[</span><span class="s1">'per_minute'</span><span class="p">]</span>
  <span class="no">PerHour</span><span class="o">=</span> <span class="n">cagg</span><span class="p">[</span><span class="s1">'per_hour'</span><span class="p">]</span>
  <span class="no">PerDay</span> <span class="o">=</span> <span class="n">cagg</span><span class="p">[</span><span class="s1">'per_day'</span><span class="p">]</span>
  <span class="no">PerMonth</span> <span class="o">=</span> <span class="n">cagg</span><span class="p">[</span><span class="s1">'per_month'</span><span class="p">]</span>
  <span class="no">GemsPerMinute</span> <span class="o">=</span> <span class="n">cagg</span><span class="p">[</span><span class="s1">'gems_per_minute'</span><span class="p">]</span>
  <span class="no">GemsPerHour</span><span class="o">=</span> <span class="n">cagg</span><span class="p">[</span><span class="s1">'gems_per_hour'</span><span class="p">]</span>
  <span class="no">GemsPerDay</span> <span class="o">=</span> <span class="n">cagg</span><span class="p">[</span><span class="s1">'gems_per_day'</span><span class="p">]</span>
  <span class="no">GemsPerMonth</span><span class="o">=</span> <span class="n">cagg</span><span class="p">[</span><span class="s1">'gems_per_month'</span><span class="p">]</span>
  <span class="no">VersionsPerMinute</span><span class="o">=</span> <span class="n">cagg</span><span class="p">[</span><span class="s1">'versions_per_minute'</span><span class="p">]</span>
  <span class="no">VersionsPerHour</span> <span class="o">=</span> <span class="n">cagg</span><span class="p">[</span><span class="s1">'versions_per_hour'</span><span class="p">]</span>
  <span class="no">VersionsPerDay</span> <span class="o">=</span> <span class="n">cagg</span><span class="p">[</span><span class="s1">'versions_per_day'</span><span class="p">]</span>
  <span class="no">VersionsPerMonth</span> <span class="o">=</span> <span class="n">cagg</span><span class="p">[</span><span class="s1">'versions_per_month'</span><span class="p">]</span>
<span class="k">end</span> <span class="c1"># Download class</span>
</code></pre></div></div>

<p>Now, the materialized views are just a massive naming for each query:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="p">{</span>
    <span class="ss">per_minute: </span><span class="no">Download</span><span class="p">.</span><span class="nf">per_minute</span><span class="p">,</span>
    <span class="ss">per_hour: </span><span class="no">Download</span><span class="o">::</span><span class="no">PerMinute</span><span class="p">.</span><span class="nf">per_hour</span><span class="p">(</span><span class="ss">:sum_downloads</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    <span class="ss">per_day: </span><span class="no">Download</span><span class="o">::</span><span class="no">PerHour</span><span class="p">.</span><span class="nf">per_day</span><span class="p">(</span><span class="ss">:sum_downloads</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    <span class="ss">per_month: </span><span class="no">Download</span><span class="o">::</span><span class="no">PerDay</span><span class="p">.</span><span class="nf">per_month</span><span class="p">(</span><span class="ss">:sum_downloads</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>

    <span class="ss">gems_per_minute: </span><span class="no">Download</span><span class="p">.</span><span class="nf">gems_per_minute</span><span class="p">,</span>
    <span class="ss">gems_per_hour: </span><span class="no">Download</span><span class="o">::</span><span class="no">GemsPerMinute</span><span class="p">.</span><span class="nf">per_hour</span><span class="p">(</span><span class="s2">"gem_name, count(*) as downloads"</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
    <span class="ss">gems_per_day: </span><span class="no">Download</span><span class="o">::</span><span class="no">GemsPerHour</span><span class="p">.</span><span class="nf">per_day</span><span class="p">(</span><span class="s2">"gem_name, count(*) as downloads"</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
    <span class="ss">gems_per_month: </span><span class="no">Download</span><span class="o">::</span><span class="no">GemsPerDay</span><span class="p">.</span><span class="nf">per_month</span><span class="p">(</span><span class="s2">"gem_name, count(*) as downloads"</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>

    <span class="ss">versions_per_minute: </span><span class="no">Download</span><span class="p">.</span><span class="nf">versions_per_minute</span><span class="p">,</span>
    <span class="ss">versions_per_hour: </span><span class="no">Download</span><span class="o">::</span><span class="no">VersionsPerMinute</span><span class="p">.</span><span class="nf">per_hour</span><span class="p">(</span><span class="s2">"gem_name, gem_version, count(*) as downloads"</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
    <span class="ss">versions_per_day: </span><span class="no">Download</span><span class="o">::</span><span class="no">VersionsPerHour</span><span class="p">.</span><span class="nf">per_day</span><span class="p">(</span><span class="s2">"gem_name, gem_version, count(*) as downloads"</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
    <span class="ss">versions_per_month: </span><span class="no">Download</span><span class="o">::</span><span class="no">VersionsPerDay</span><span class="p">.</span><span class="nf">per_month</span><span class="p">(</span><span class="s2">"gem_name, gem_version, count(*) as downloads"</span><span class="p">).</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
  <span class="p">}.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">scope</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="s2">"Creating continuous aggregate </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">scope</span><span class="p">.</span><span class="nf">to_sql</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">'per_'</span><span class="p">).</span><span class="nf">last</span>
    <span class="n">create_continuous_aggregate</span><span class="p">(</span>
      <span class="s2">"downloads_</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
      <span class="n">scope</span><span class="p">.</span><span class="nf">to_sql</span><span class="p">,</span>
      <span class="ss">refresh_policies: </span><span class="p">{</span>
        <span class="ss">schedule_interval: </span><span class="s2">"INTERVAL '1 </span><span class="si">#{</span><span class="n">frame</span><span class="si">}</span><span class="s2">'"</span><span class="p">,</span>
        <span class="ss">start_offset: </span><span class="s2">"INTERVAL '3 </span><span class="si">#{</span><span class="n">frame</span><span class="si">}</span><span class="s2">'"</span><span class="p">,</span>
        <span class="ss">end_offset: </span><span class="s2">"INTERVAL '1 minute'"</span>
      <span class="p">})</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>And with such a simple code, you can build the materialized views to track the
downloads per gem, version, and day.</p>

<p>Let’s explore a bit what we have built so far:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Download</span><span class="p">.</span><span class="nf">first</span>
<span class="c1"># =&gt; #&lt;Download:0x000000012791f050</span>
 <span class="ss">ts: </span><span class="mi">2024</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">26</span> <span class="mo">00</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">54</span> <span class="no">UTC</span><span class="p">,</span>
 <span class="ss">gem_name: </span><span class="s2">"racc"</span><span class="p">,</span>
 <span class="ss">gem_version: </span><span class="s2">"1.7.3-java"</span><span class="p">,</span>
 <span class="ss">payload: </span><span class="p">{</span><span class="s2">"env"</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">"ruby"</span><span class="o">=&gt;</span><span class="s2">"3.1.0"</span><span class="p">,</span> <span class="s2">"bundler"</span><span class="o">=&gt;</span><span class="s2">"2.5.9"</span><span class="p">,</span> <span class="s2">"rubygems"</span><span class="o">=&gt;</span><span class="s2">"3.3.25"</span><span class="p">}}</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>Now, let’s explore overall downloads per gem:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Download</span><span class="p">.</span><span class="nf">gems_per_minute</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:attributes</span><span class="p">)</span>
</code></pre></div></div>

<p>This is going to raw data not using the materialized views:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span>
<span class="p">{</span><span class="s2">"ts"</span><span class="o">=&gt;</span><span class="mi">2024</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">26</span> <span class="mo">00</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mo">00</span> <span class="no">UTC</span><span class="p">,</span> <span class="s2">"gem_name"</span><span class="o">=&gt;</span><span class="s2">"google-cloud-env"</span><span class="p">,</span> <span class="s2">"downloads"</span><span class="o">=&gt;</span><span class="mi">3</span><span class="p">},</span>
 <span class="p">{</span><span class="s2">"ts"</span><span class="o">=&gt;</span><span class="mi">2024</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">26</span> <span class="mo">00</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mo">00</span> <span class="no">UTC</span><span class="p">,</span> <span class="s2">"gem_name"</span><span class="o">=&gt;</span><span class="s2">"systemu"</span><span class="p">,</span> <span class="s2">"downloads"</span><span class="o">=&gt;</span><span class="mi">2</span><span class="p">},</span>
 <span class="p">{</span><span class="s2">"ts"</span><span class="o">=&gt;</span><span class="mi">2024</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">26</span> <span class="mo">00</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mo">00</span> <span class="no">UTC</span><span class="p">,</span> <span class="s2">"gem_name"</span><span class="o">=&gt;</span><span class="s2">"racc"</span><span class="p">,</span> <span class="s2">"downloads"</span><span class="o">=&gt;</span><span class="mi">6</span><span class="p">},</span>
 <span class="p">{</span><span class="s2">"ts"</span><span class="o">=&gt;</span><span class="mi">2024</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">26</span> <span class="mo">00</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mo">00</span> <span class="no">UTC</span><span class="p">,</span> <span class="s2">"gem_name"</span><span class="o">=&gt;</span><span class="s2">"message_bus"</span><span class="p">,</span> <span class="s2">"downloads"</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">},</span>
 <span class="p">{</span><span class="s2">"ts"</span><span class="o">=&gt;</span><span class="mi">2024</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">26</span> <span class="mo">00</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mo">00</span> <span class="no">UTC</span><span class="p">,</span> <span class="s2">"gem_name"</span><span class="o">=&gt;</span><span class="s2">"rails-dom-testing"</span><span class="p">,</span> <span class="s2">"downloads"</span><span class="o">=&gt;</span><span class="mi">4</span><span class="p">},</span>
 <span class="c1"># ...</span>
<span class="p">]</span>
</code></pre></div></div>

<h1 id="exploring-the-materialized-views">Exploring the materialized views</h1>

<p>Continuous aggregates are a way to keep the materialized views up-to-date. The
background jobs will just check what is the missing data and update the materialized
views.</p>

<p>Now, start with the sum of all gems per minute in the continuous aggregate:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Download</span><span class="o">::</span><span class="no">PerMinute</span><span class="p">.</span><span class="nf">first</span>
<span class="c1"># D, [2024-07-04T16:49:51.714221 #94112] DEBUG -- :   Download::PerMinute Load (2.9ms)  SELECT "downloads_per_minute".* FROM "downloads_per_minute" LIMIT $1  [["LIMIT", 1]]</span>
<span class="c1"># =&gt; #&lt;Download::PerMinute:0x0000000128a012d8 ts: 2024-04-26 00:10:00 UTC, downloads: 110&gt;</span>
</code></pre></div></div>

<p>Now, let’s explore downloads of rails gems per minute:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Download</span><span class="o">::</span><span class="no">GemsPerMinute</span><span class="p">.</span><span class="nf">where</span> <span class="ss">gem_name: </span><span class="s2">"rails"</span>
<span class="c1"># D, [2024-07-04T16:51:12.707122 #94112] DEBUG -- :   Download::GemsPerMinute Load (5.0ms)  SELECT "downloads_gems_per_minute".* FROM "downloads_gems_per_minute" WHERE "downloads_gems_per_minute"."gem_name" = $1 /* loading for pp */ LIMIT $2  [["gem_name", "rails"], ["LIMIT", 11]]</span>
<span class="c1"># =&gt; [#&lt;Download::GemsPerMinute:0x000000012822c1c0</span>
  <span class="ss">ts: </span><span class="mi">2024</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">26</span> <span class="mo">00</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mo">00</span> <span class="no">UTC</span><span class="p">,</span>
  <span class="ss">gem_name: </span><span class="s2">"rails"</span><span class="p">,</span>
  <span class="ss">downloads: </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="c1">#&lt;Download::GemsPerMinute:0x000000012822c080</span>
  <span class="ss">ts: </span><span class="mi">2024</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">26</span> <span class="mo">00</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mo">00</span> <span class="no">UTC</span><span class="p">,</span>
  <span class="ss">gem_name: </span><span class="s2">"rails"</span><span class="p">,</span>
  <span class="ss">downloads: </span><span class="mi">4</span><span class="o">&gt;</span><span class="p">,</span>
</code></pre></div></div>

<p>Let’s break down using the version now:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Download</span><span class="o">::</span><span class="no">VersionsPerMinute</span><span class="p">.</span><span class="nf">where</span> <span class="ss">gem_name: </span><span class="s2">"rails"</span>
<span class="c1"># D, [2024-07-04T16:53:35.566434 #94112] DEBUG -- :   Download::VersionsPerMinute Load (6.0ms)  SELECT "downloads_versions_per_minute".* FROM "downloads_versions_per_minute" WHERE "downloads_versions_per_minute"."gem_name" = $1 /* loading for pp */ LIMIT $2  [["gem_name", "rails"], ["LIMIT", 11]]</span>
<span class="c1"># =&gt; [#&lt;Download::VersionsPerMinute:0x000000012882e320</span>
  <span class="ss">ts: </span><span class="mi">2024</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">26</span> <span class="mo">00</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mo">00</span> <span class="no">UTC</span><span class="p">,</span>
  <span class="ss">gem_name: </span><span class="s2">"rails"</span><span class="p">,</span>
  <span class="ss">gem_version: </span><span class="s2">"1.2.3.4"</span><span class="p">,</span>
  <span class="ss">downloads: </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="c1">#&lt;Download::VersionsPerMinute:0x0000000128264890</span>
  <span class="ss">ts: </span><span class="mi">2024</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">26</span> <span class="mo">00</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mo">00</span> <span class="no">UTC</span><span class="p">,</span>
  <span class="ss">gem_name: </span><span class="s2">"rails"</span><span class="p">,</span>
  <span class="ss">gem_version: </span><span class="s2">"1.2.3.4"</span><span class="p">,</span>
  <span class="ss">downloads: </span><span class="mi">2</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="c1">#&lt;Download::VersionsPerMinute:0x0000000128264750</span>
  <span class="ss">ts: </span><span class="mi">2024</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">26</span> <span class="mo">00</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mo">00</span> <span class="no">UTC</span><span class="p">,</span>
  <span class="ss">gem_name: </span><span class="s2">"rails"</span><span class="p">,</span>
  <span class="ss">gem_version: </span><span class="s2">"6.1.7"</span><span class="p">,</span>
  <span class="ss">downloads: </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="c1"># ...</span>
<span class="p">]</span>
</code></pre></div></div>

<p>We have built a simple ingest pipeline to track the downloads per gem, version,
and day. We have built the materialized views to track the downloads per gem,
version, by minute, hour, and day.</p>

<h2 id="next-steps">Next steps</h2>

<p>The PoC is complete, and my next step is to migrate all the important pieces as
production-ready code. But as production code, we need to keep it clean and make
it step by step.</p>

<ol>
  <li>Introduce the migration to build the tables and the continuous aggregates.</li>
  <li>Introduce a new <a href="https://github.com/rubygems/rubygems.org/blob/6e919e3cc077abde5553b19afe6efbdcb04e106a/app/jobs/fastly_log_processor.rb#L44-L67">FastlyLogProcessor</a> that uses the already-implemented parser.</li>
  <li>Schedule a Job that uses the processor to get new files from the <a href="https://github.com/rubygems/rubygems.org/blob/e7faec5ad1b43162368b77e0f4add8f6bd932cbb/lib/shoryuken/sqs_worker.rb#L26">SQS</a> the logs when a new log is
available.</li>
  <li>Create a refresh policy to keep the materialized views up-to-date.</li>
  <li>Create a maintenance task to migrate all previous logs available.</li>
  <li>Create a dashboard to track the downloads and offer more insights to gem
creators and users.</li>
</ol>

<p>I hope you enjoyed this journey and I’m going to be implementing the next steps.
Keep an eye on the <a href="https://github.com/rubygems/rubygems.org/issues/4642">open issue</a> to check for new updates.</p>

<p>If you want to know more about TimescaleDB, check out the <a href="https://rubygems.org/gems/timescaledb">timescaledb gem</a>
and the <a href="https://github.com/timescale/timescaledb">timescaledb extension</a>.</p>

<h2 id="thanks-rubygems-team">Thanks RubyGems team</h2>

<p>I just want to say thanks to the RubyGems team for the opportunity, especially
<a href="https://github.com/simi">@simi</a> and <a href="https://github.com/colby-swandale">@colby-swandale</a> for their support and guidance in
helping me merge this contribution.</p>

<p>I’m looking forward to the next steps, and I’m excited to keep contributing to the RubyGems project.</p>

<p>I just want to say thanks to the RubyGems team for the opportunity and
especially the support and guidance from 
to help me to get this contribution merged.</p>

<p>I’m looking forward to the next steps and I’m excited to keep contributing to the
RubyGems project.</p>


</div>
<hr>

<div class="share-page">
  Share &rarr;
  <a href="https://twitter.com/intent/tweet?text=My First Contribution To Rubygems&url=https://ideia.me/my-first-contribution-to-rubygems&via=jonatasdp&related=jonatasdp" rel="nofollow"title="Share on twitter">Twitter</a>
  <a href="https://facebook.com/sharer.php?u=https://ideia.me/my-first-contribution-to-rubygems" rel="nofollow" target="_blank" title="Share on Facebook">Facebook</a>
  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://ideia.me/my-first-contribution-to-rubygems" rel="nofollow" target="_blank" title="Share on Linkedin">Linkedin</a>
</div>
<hr>
<div class="pagination">
    
      <span class="prev">
        <a href="/grepping-sql-code-like-a-boss" title="Grepping SQL Code like a boss">&larr; Before</a>
      </span>
    
    | <span><a href="/archive.html">Archive</a></span> |
    
    <span class="next"><a href="/timescaledb-gem-continuous-aggregates-updates" title="TimescaleDB Gem Continuous Aggregates Updates">Next &rarr;</a></span>
    
</div>
<hr>

<p>
  Hello there, my name is Jônatas Davi Paganini and this is my personal blog.
  <br />
  I'm developer advocate at <a href="https://timescale.com">Timescale</a> and
  I also have a few open source projects on <a href="https://github.com/jonatas">github</a>.
</p>
<p>Check my
  <a href="/talks">talks</a> or connect with me via
  <a href="https://br.linkedin.com/in/jonatasdp" target="_blank">linkedin</a> /
  <a href="https://twitter.com/jonatasdp" target="_blank">twitter</a> /
  <a href="https://github.com/jonatas" target="_blank">github</a> /
  <a href="https://instagram.com/jonatasdp" target="_blank">instagram</a> /
  <a href="https://fb.com/jonatas.paganini" target="_blank">facebook</a> /
  <a href="https://www.strava.com/athletes/12104550" target="_blank">strava</a> /
  <a href="http://www.meetup.com/members/185190193/" target="_blank">meetup</a>.
</p>



    </div>
  </body>
</html>

