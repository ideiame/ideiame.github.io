
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NV80WM9HT0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NV80WM9HT0');
</script>

    <script async
src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1171230226237014"
crossorigin="anonymous"></script>

    <meta charset="utf-8">
    <title>Ideia-me!</title>
    
    <meta name="author" content="Jônatas Davi Paganini">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link id="bootstrap" href="/css/bootstrap.css" rel="stylesheet">
    <link id="bootstrap" href="/css/bootswatch.min.css" rel="stylesheet">
    <link href="/css/nimbus-pygments.css" rel="stylesheet">

    <script src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/bootstrap-dropdown.js"></script>
    <div id="fb-root"></div>

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
  <script type="text/javascript" language="javascript" charset="utf-8">
// <![CDATA[
    addEventListener('load', function (event) {
      var agent=navigator.userAgent.toLowerCase();
      var links = document.getElementsByTagName('a');
      var regex = new RegExp('^'+window.location.protocol + '//' + window.location.hostname);

      for (var i = 0, linksLength = links.length; i < linksLength; i++) {
        if ( ! links[i].href.match(regex)) {
           links[i].setAttribute('target', '_blank');
       }
     }

    }, false);
// ]]>
</script>
</head>
<body>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v2.5&appId=138593009602387";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a href="/">
            <img class="img-circle" alt="ideiame logo" style="padding-top: 6px" src="/images/ideiame.png"></a>
            <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
           </button>
       </div>
   <div class="navbar-collapse collapse" id="navbar-main">
     <ul class="nav navbar-nav">
      <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Social<b class="caret"></b></a>
            <ul class="dropdown-menu" id="swatch-menu">
              <li><a href="https://github.com/jonatas">Github</a></li>
              <li><a href="https://twitter.com/jonatasdp">Twitter</a></li>
              <li><a href="https://instagram.com/jonatasdp">Instagram</a></li>
              <li><a href="https://www.meetup.com/Floripa-on-Rails/members/185190193/">Meetup</a></li>
              <li><a href="https://www.slideshare.net/jonataspaganini/">SlideShare</a></li>
              <li><a href="https://facebook.com/jonatas.paganini">Facebook</a></li>
              <li><a href="https://www.youtube.com/user/jonatasdp">Youtube</a></li>
           </ul>
          </li>
          <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Projects<b class="caret"></b></a>
            <ul class="dropdown-menu">
            <li><a href="https://github.com/jonatas/fast">Fast</a></li>
            <li><a href="http://torf.ideia.me">2015: True Or False Game</a></li>
            <li><a href="http://github.com/jonatas/pixel.ideia.me">2013: Pixel art (collaborative) </a></li>
            <li><a href="http://github.com/jonatas/trybliss">2013: Try Bliss</a</li>
            <li><a href="http://github.com/jonatas/churumelas">2012: Regexp challenges</a></li>
            <li><a href="/camera-overlay">2012: Camera Overlay </a></li>
           </ul>
          </li>
          
          
          


  
    
      
      	
      	<li><a href="/archive">Arquivo</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories">Categorias</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  



          </ul>
        </div>
      </div>
     </div>
    </div>
    <div class="container">
      
<div class="page-header">
  <h1>Ideia-me! </h1>
</div>

<div class="row-fluid">
  <div class="span12">
    
<p>
  Hello there, my name is Jônatas Davi Paganini and this is my personal blog.
  <br />
  I'm developer advocate at <a href="https://timescale.com">Timescale</a> and
  I also have a few open source projects on <a href="https://github.com/jonatas">github</a>.
</p>
<p>Check my
  <a href="/talks">talks</a> or connect with me via
  <a href="https://br.linkedin.com/in/jonatasdp" target="_blank">linkedin</a> /
  <a href="https://twitter.com/jonatasdp" target="_blank">twitter</a> /
  <a href="https://github.com/jonatas" target="_blank">github</a> /
  <a href="https://instagram.com/jonatasdp" target="_blank">instagram</a> /
  <a href="https://fb.com/jonatas.paganini" target="_blank">facebook</a> /
  <a href="https://www.strava.com/athletes/12104550" target="_blank">strava</a> /
  <a href="http://www.meetup.com/members/185190193/" target="_blank">meetup</a>.
</p>

<hr />

<h1 class="post"><a class="post" href="/grepping-sql-code-like-a-boss"> Grepping SQL Code like a boss</a></h1>
<p>Here’s the outline of the content of my talk in Poland I presented at the
<a href="https://lambdadays.com/2024">Lambda Days 2024</a>.</p>

<div class="video-container">
       <iframe width="560" height="420" frameborder="0" allowfullscreen="" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" src="https://www.youtube.com/embed/hGWXBg4Hkn0?color=white&amp;theme=light">
       </iframe>
    </div>

<p>My talk is a research which I call “grepping SQL code like a boss”.
Introducing a set of tooling that can not only search but also refactor SQL code like a boss.</p>

<p>This is most of the talk outline for those folks that want to learn more about the topic.</p>

<p>It will be a mix of Ruby and SQL code examples. I will show you how to use the
<code class="language-plaintext highlighter-rouge">fast</code> gem to build your own tools to search and refactor SQL code.</p>

<p>The <code class="language-plaintext highlighter-rouge">fast</code> gem is a tool that leverages ASTs to provide advanced search and
refactoring capabilities. It already supports Ruby and recently I introduced
support for SQL code.</p>

<p>My main intent is not “sell” my library but the idea behind it. You can easily
build something similar in your language or even to your SQL dialect.</p>

<h2 id="2-decades-in-the-terminal">2 decades in the terminal</h2>

<p>Yes, not only the presentation was made in the terminal, but I build my entire
carreer in the terminal. IO is simple and easy. I can focus on the content and not the tools.</p>

<p>I’m already familiar with this toolset and I can build my own tools to help me
and enhance my productivity.</p>

<h2 id="learn-simple-tools-with-single-proposal">Learn simple tools with single proposal</h2>

<p>I love how unix tools are simple and have a single proposal. My favorite minimalist
examples from unix like <code class="language-plaintext highlighter-rouge">cat head wc sort uniq grep sed echo</code>.</p>

<p>Markdown is a great example of simplification. Look how easy it to navigate into
count the topics of talk in the terminal:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">grep</span> <span class="s1">'^# '</span> talk-sql.md | <span class="nb">wc</span> <span class="nt">-l</span> <span class="c"># =&gt; 60</span>
</code></pre></div></div>

<p>Now, going deep in regular expressions we can also count the examples of Ruby, SQL
and so on…</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">grep</span> <span class="s1">'```ruby'</span> talk-sql.md | <span class="nb">wc</span> <span class="nt">-l</span> <span class="c"># =&gt; 29</span>
<span class="nb">grep</span> <span class="s1">'```sql'</span> talk-sql.md | <span class="nb">wc</span> <span class="nt">-l</span> <span class="c"># =&gt; 5</span>
<span class="nb">grep</span> <span class="s1">'```bash'</span> talk-sql.md | <span class="nb">wc</span> <span class="nt">-l</span> <span class="c"># =&gt; 9</span>
</code></pre></div></div>

<p>Now, let me share a past project that encouraged me to follow and continue
investing on this idea.</p>

<h2 id="todo-kill-pr-review-checklist">TODO: kill PR review checklist</h2>

<p>I had a very extensive experience onboarding developers. I onboarded 300+
backend developers in 5 years.</p>

<p>One of the most boring things on onboarding is align the quality expectations,
and that’s why the review process involves CI with lots of linters plus a huge
PR review checklist. You can expect things like:</p>

<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Check the code style</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Check the usage of the framework components</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Check the broken links in the documentation</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Check the performance</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Check the security</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Check the architecture</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Check the design</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Check the business logic</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Check the requirements</li>
</ul>

<p>So, I was eager to reduce the friction of introducing newcomers by helping them
to have less things to get ready for the first Pull Request. The plan started
automating item by item, so the newcomer does not have to face “Don’t use A
insted of B” while they’re not even familiar with the codebase.</p>

<p>Introducing a set of custom linters related to the business domain was the way to
properly guide developers to use the right framework components.</p>

<h3 id="automate-the-education">Automate the education</h3>

<p>Pull Requests can have a insane bureaucracy during the review. From all CI to 
comments and reviews, more automation we add, less human interaction and no
developers taking into personal consideration the feedback.</p>

<p>It also allows the developers to have more interesting conversations during the
review instead of few drawn by the checklist and other bureaucracies.</p>

<h2 id="build-smart-stuff-with-simple-tools">Build smart stuff with simple tools</h2>

<p>AST brings the most primitive stage of compilers into scene. Tagging word by word
or token by token, it simply structures code into tree format.</p>

<p>You really don’t need advanced tools to build smart stuff. You can build most of
it with simple tools.</p>

<h2 id="im-a-rubyist">I’m a Rubyist</h2>

<p>Yes, I’m a Rubyist. I love Ruby. I love the community. I love the language.
I started the fast gem to grep Ruby code like a boss. Recently, I extended it to
SQL.</p>

<p>You can check my previous talk on <a href="https://youtube.com/watch?v=YczrZQC9aP8">youtube</a>
which I was grepping Ruby code like a boss. This was for Ruby Kaigi 2020 which I
couldn’t come because of the lock down but I was able to record and participate
remotely.</p>

<p>I also maintain the timescaledb ruby gem which wraps all TimescaleDB SQL
features into simple macros: github.com/jonatas/timescaledb</p>

<h2 id="im-becoming-a-postgrist">I’m becoming a Postgrist</h2>

<p>I’m a Rubyist, I’m not sure this word exists, but I’m coining the term Postgrist.
I’m learning a lot about PostgreSQL and TimescaleDB.</p>

<p>I split my time between community management and developer advocacy.</p>

<h2 id="adventures-with-fast">Adventures with fast</h2>

<p>Now, several years after fast was born, I’m extending it to SQL. I’m building
a base prototype for SQL linters or refactoring tools.</p>

<ul>
  <li>https://github.com/jonatas/fast</li>
  <li>
    <p>https://rubygems.org/gems/ffast</p>

    <p>$ gem install ffast</p>
  </li>
</ul>

<p>You can just use exactly the same syntax for building node patterns both on sql
and Ruby. The trees are different but follow the same structure, so it’s a
matter of learning the new node types and you’re ready to go.</p>

<h2 id="the-value-of-trying">The Value of Trying</h2>

<p>I really believe in the value of trying. I’m a researcher, trying new things. I’m always
scratching my own itch.</p>

<blockquote>
  <p>Experimenting = growth</p>
</blockquote>

<blockquote>
  <p>Growth only happens when you learn from your experiments.</p>
</blockquote>

<p>I built a tool named fast to grep Ruby &amp; SQL code like a boss.</p>

<ul>
  <li>My journey with “compilers”, ASTs, and code analysis</li>
  <li>My journey with SQL</li>
  <li>Advanced search and refactoring</li>
</ul>

<h2 id="the-power-of-regex">The Power of Regex</h2>

<blockquote>
  <p>Regular expressions are a powerful tool for searching and manipulating text.
They are widely used in text editors, programming languages, and other tools.</p>
</blockquote>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"1 + 2"</span><span class="p">.</span><span class="nf">scan</span><span class="p">(</span><span class="sr">/\d+/</span><span class="p">)</span> <span class="c1"># =&gt; ["1", "2"]</span>
</code></pre></div></div>

<h2 id="regex-operators">Regex operators</h2>

<p>A few operators to remind how it works:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">\d</code> - digit</li>
  <li><code class="language-plaintext highlighter-rouge">+</code> - one or more</li>
  <li><code class="language-plaintext highlighter-rouge">*</code> - zero or more</li>
  <li><code class="language-plaintext highlighter-rouge">?</code> - zero or one</li>
  <li><code class="language-plaintext highlighter-rouge">|</code> - or</li>
  <li><code class="language-plaintext highlighter-rouge">()</code> - capture group</li>
  <li><code class="language-plaintext highlighter-rouge">[]</code> - character class</li>
  <li><code class="language-plaintext highlighter-rouge">{}</code> - quantifier</li>
</ul>

<h2 id="limitations-of-regex">Limitations of Regex</h2>

<blockquote>
  <p>Regex can be difficult to use for complex searches and refactoring tasks.</p>
</blockquote>

<p>If you need to build a “search and fix” scenario, example, if you find the
target code, maybe it’s in the wrong context. So, several times, the Regular
Expressions cannot be the silver bullet for targetting text.</p>

<p>Capturing and reusing previous information, ignoring other undesired scenarios.
Nested contexts and scenarios plays a big role on refactoring, several times
needing to capture groups of information.</p>

<p>Sometimes, regex is not enough to solve complex problems. If you’re trying to
parse a programming language, you need to deal with nested structures.</p>

<p>Now, it’s time to start exploring on how to build a micro-engine for a derived
Regular Expression language that can match elements directly from the AST.</p>

<h2 id="the-ast-advantage">The AST Advantage</h2>

<p>Abstract Syntax Trees are made for programming language internals. It provides a
more powerful and flexible way to search and manipulate code. In this example,
I’m using the <code class="language-plaintext highlighter-rouge">ffast</code> gem which uses <code class="language-plaintext highlighter-rouge">ruby-parser</code> to parse the Ruby code.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Fast</span><span class="p">.</span><span class="nf">ast</span><span class="p">(</span><span class="s2">"1"</span><span class="p">).</span><span class="nf">type</span> <span class="c1"># =&gt; :int</span>
<span class="no">Fast</span><span class="p">.</span><span class="nf">ast</span><span class="p">(</span><span class="s2">"1"</span><span class="p">).</span><span class="nf">children</span> <span class="c1"># =&gt; [1]</span>
</code></pre></div></div>

<p>Every node in the AST has a type and children. The type is a symbol and the children.</p>

<h2 id="the-ast-in-ruby">The AST in Ruby</h2>

<p>There’s an interesting way to represent the AST in Ruby. It’s called S-Expression
AKA string expression. It’s a simple way to represent the AST in a human-readable format.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">puts</span> <span class="no">Fast</span><span class="p">.</span><span class="nf">ast</span><span class="p">(</span><span class="s2">"1"</span><span class="p">)</span>
</code></pre></div></div>

<p>Output:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>int 1<span class="o">)</span>
</code></pre></div></div>

<p>The S-Expression is the base inpiration for the node pattern we’re going to use
to search and refactor the code.</p>

<p>Let’s explore more examples to get familiar:</p>

<h3 id="ast-of-summing-two-numbers-in-ruby">AST of summing two numbers in Ruby</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">puts</span> <span class="no">Fast</span><span class="p">.</span><span class="nf">ast</span><span class="p">(</span><span class="s2">"1 + 2"</span><span class="p">)</span>
</code></pre></div></div>

<p>Outputs the String Expression aka sexp in Ruby:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>send
  <span class="o">(</span>int 1<span class="o">)</span> :+
  <span class="o">(</span>int 2<span class="o">))</span>
</code></pre></div></div>

<h2 id="search-in-the-ast">Search in the AST</h2>

<p>The Abstract part of the Syntax Tree unifies the code syntax. It’s a common way
to represent the code in a structured format.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Fast</span><span class="p">.</span><span class="nf">ast</span><span class="p">(</span><span class="s2">"1 + 2.0"</span><span class="p">).</span><span class="nf">search</span><span class="p">(</span><span class="s2">"int"</span><span class="p">)</span>        <span class="c1"># =&gt; [s(:int, 1)]</span>
<span class="no">Fast</span><span class="p">.</span><span class="nf">ast</span><span class="p">(</span><span class="s2">"1 + 2.0"</span><span class="p">).</span><span class="nf">search</span><span class="p">(</span><span class="s2">"(float _)"</span><span class="p">)</span>  <span class="c1"># =&gt; [s(:float, 2.0)]</span>
</code></pre></div></div>

<p>Similar to the sexp output, oyou can build nested search for children using <code class="language-plaintext highlighter-rouge">()</code>
or combine with other operators.</p>

<p>Example of search combining <strong>or</strong> expressions with the <code class="language-plaintext highlighter-rouge">{}</code> operator.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Fast</span><span class="p">.</span><span class="nf">ast</span><span class="p">(</span><span class="s2">"1 + 2.0"</span><span class="p">).</span><span class="nf">search</span><span class="p">(</span><span class="s2">"{int float}"</span><span class="p">)</span>  <span class="c1"># =&gt; [s(:int, 1), s(:float, 2.0)]</span>
</code></pre></div></div>
<h2 id="combining-node-patterns">Combining node patterns</h2>

<p>Example matches integer or float, both should be positive values.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Fast</span><span class="p">.</span><span class="nf">ast</span><span class="p">(</span><span class="s2">"1 + 2.0"</span><span class="p">).</span><span class="nf">search</span><span class="p">(</span><span class="s2">"({int float} .positive?)"</span><span class="p">)</span>
<span class="c1"># =&gt; [s(:int, 1), s(:float, 2.0)]</span>
</code></pre></div></div>

<blockquote>
  <p>Note that <code class="language-plaintext highlighter-rouge">.positive?</code> comes from the attempt to verify the method from the AST values.</p>
</blockquote>

<h2 id="fast---like-regex-but-for-the-ast">Fast - Like regex but for the AST</h2>

<p>So, the node pattern expressions can be composed with:</p>

<ul>
  <li>‘exp’ which represents the full match with the content.</li>
  <li>‘(type *children)’</li>
  <li>‘_’ for anything not nil</li>
  <li>’{ this or that }’</li>
  <li>’[ this and that ]’</li>
  <li>‘_’ and ‘…’ for something or a node with children
_ ‘$’ for captures
_ ‘!’ to negate
_ ‘#method’ to call a <code class="language-plaintext highlighter-rouge">method</code> with the node as param</li>
</ul>

<blockquote>
  <p>Try fast .finders</p>
</blockquote>

<h2 id="sql-support-in-fast">SQL Support in ‘fast’</h2>

<p>Fast now can also <a href="https://jonatas.github.io/fast/sql-support/">parse SQL</a>
from PostgreSQL. The AST conversion is very similar to what you have in the Ruby AST.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Fast</span><span class="p">.</span><span class="nf">parse_sql</span><span class="p">(</span><span class="s1">'select 1'</span><span class="p">)</span>
<span class="n">s</span><span class="p">(</span><span class="ss">:select_stmt</span><span class="p">,</span>
  <span class="n">s</span><span class="p">(</span><span class="ss">:target_list</span><span class="p">,</span>
    <span class="n">s</span><span class="p">(</span><span class="ss">:res_target</span><span class="p">,</span>
      <span class="n">s</span><span class="p">(</span><span class="ss">:val</span><span class="p">,</span>
        <span class="n">s</span><span class="p">(</span><span class="ss">:a_const</span><span class="p">,</span>
          <span class="n">s</span><span class="p">(</span><span class="ss">:ival</span><span class="p">,</span>
            <span class="n">s</span><span class="p">(</span><span class="ss">:ival</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))))))</span>
</code></pre></div></div>

<p>And the SQL parser is just forwarding the pg_query AST to converge into a format
that Fast is already familiar with.</p>

<p>In reality, the pg_query (PostgreSQL C bindings) do the heavy work and my
library allows to reuse all these AST metadata with node patterns and
refactoring methods.</p>

<p>Here’s the full implementation of the parsing:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># lib/fast/sql.rb:110</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="ss">buffer_name: </span><span class="s2">"(sql)"</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">statement</span><span class="p">.</span><span class="nf">nil?</span>
      <span class="n">source_buffer</span> <span class="o">=</span> <span class="no">SQL</span><span class="o">::</span><span class="no">SourceBuffer</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">buffer_name</span><span class="p">,</span> <span class="ss">source: </span><span class="n">statement</span><span class="p">)</span>
      <span class="n">tree</span> <span class="o">=</span> <span class="no">PgQuery</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">statement</span><span class="p">).</span><span class="nf">tree</span>
      <span class="n">first</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="n">source_buffer</span><span class="p">.</span><span class="nf">tokens</span>
      <span class="n">stmts</span> <span class="o">=</span> <span class="n">tree</span><span class="p">.</span><span class="nf">stmts</span><span class="p">.</span><span class="nf">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">stmt</span><span class="o">|</span>
        <span class="n">from</span> <span class="o">=</span> <span class="n">stmt</span><span class="p">.</span><span class="nf">stmt_location</span>
        <span class="n">to</span> <span class="o">=</span> <span class="n">stmt</span><span class="p">.</span><span class="nf">stmt_len</span><span class="p">.</span><span class="nf">zero?</span> <span class="p">?</span> <span class="n">last</span><span class="p">.</span><span class="nf">end</span> <span class="p">:</span> <span class="n">from</span> <span class="o">+</span> <span class="n">stmt</span><span class="p">.</span><span class="nf">stmt_len</span>
        <span class="n">expression</span> <span class="o">=</span> <span class="no">Parser</span><span class="o">::</span><span class="no">Source</span><span class="o">::</span><span class="no">Range</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">source_buffer</span><span class="p">,</span> <span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">)</span>
        <span class="n">source_map</span> <span class="o">=</span> <span class="no">Parser</span><span class="o">::</span><span class="no">Source</span><span class="o">::</span><span class="no">Map</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
        <span class="n">sql_tree_to_ast</span><span class="p">(</span><span class="n">clean_structure</span><span class="p">(</span><span class="n">stmt</span><span class="p">.</span><span class="nf">stmt</span><span class="p">.</span><span class="nf">to_h</span><span class="p">),</span> <span class="ss">source_buffer: </span><span class="n">source_buffer</span><span class="p">,</span> <span class="ss">source_map: </span><span class="n">source_map</span><span class="p">)</span>
      <span class="k">end</span><span class="p">.</span><span class="nf">flatten</span>
      <span class="n">stmts</span><span class="p">.</span><span class="nf">one?</span> <span class="p">?</span> <span class="n">stmts</span><span class="p">.</span><span class="nf">first</span> <span class="p">:</span> <span class="n">stmts</span>
    <span class="k">end</span>
</code></pre></div></div>

<p>The hard work I had was more on going in the most common queries and create a
good <code class="language-plaintext highlighter-rouge">clean_structure</code> for it to allow us to have a very easy to comprehend AST
to build simple node patterns.</p>

<h2 id="fastfile">Fastfile</h2>

<p>The <code class="language-plaintext highlighter-rouge">Fastfile</code> can help to organize the dictionary of patterns in shortcuts.</p>

<p>I built it thinking about having one per project and may load something cross
projects with my generic searches.</p>

<p>The previous Ruby snippet was brought to the example based on the following
shortcut:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Fast</span><span class="p">.</span><span class="nf">shortcut</span> <span class="ss">:sql_parser</span><span class="p">,</span> <span class="s2">"(def parse)"</span><span class="p">,</span> <span class="s2">"lib/fast/sql.rb"</span>
</code></pre></div></div>
<p>So, if I want to repeat such search, I just need to say <code class="language-plaintext highlighter-rouge">fast .sql_parser</code> and
it will reuse the shortcut name to output the matching results.</p>

<h2 id="refactoring-operations">Refactoring operations</h2>

<p>The most complex part of the AST is rewriting it. Allowing you to refactor code
from the AST just with a simple method call.</p>

<p>Here’s an example of a simple replace on a <code class="language-plaintext highlighter-rouge">relname</code> which is a node type.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Fast</span>
  <span class="p">.</span><span class="nf">parse_sql</span><span class="p">(</span><span class="s2">"SELECT * FROM customers"</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="s2">"relname"</span><span class="p">,</span> <span class="s2">"other_table"</span><span class="p">)</span>
  <span class="c1"># =&gt; "SELECT * FROM other_table"</span>
</code></pre></div></div>

<p>The replace method can also receive a block and build a much more complex
scenario. The next example explores how to build a SQL formatter.</p>

<h2 id="format-sql">Format SQL</h2>

<p>I wrote a full blog post on <a href="/building-a-sql-formatter-with-fast">building a SQL formatter with fast</a>
and the final shorcut looks like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Fast</span><span class="p">.</span><span class="nf">shortcut</span> <span class="ss">:format_sql</span> <span class="k">do</span>
  <span class="nb">require</span> <span class="s1">'fast/sql'</span>
  <span class="n">file</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">.</span><span class="nf">last</span>
  <span class="nb">method</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">exist?</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="p">?</span> <span class="ss">:parse_sql_file</span> <span class="p">:</span> <span class="ss">:parse_sql</span>
  <span class="n">ast</span> <span class="o">=</span> <span class="no">Fast</span><span class="p">.</span><span class="nf">public_send</span><span class="p">(</span><span class="nb">method</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
  <span class="n">ast</span> <span class="o">=</span> <span class="n">ast</span><span class="p">.</span><span class="nf">first</span> <span class="k">if</span> <span class="n">ast</span><span class="p">.</span><span class="nf">is_a?</span> <span class="no">Array</span>
  <span class="n">eligible_kw</span> <span class="o">=</span> <span class="p">[</span><span class="ss">:RESERVED_KEYWORD</span><span class="p">]</span>
  <span class="n">eligible_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="ss">:BY</span><span class="p">]</span>

  <span class="n">output</span> <span class="o">=</span> <span class="no">Fast</span><span class="o">::</span><span class="no">SQL</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="s1">'_'</span><span class="p">,</span> <span class="n">ast</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">root</span><span class="o">|</span>
    <span class="n">sb</span> <span class="o">=</span> <span class="n">root</span><span class="p">.</span><span class="nf">loc</span><span class="p">.</span><span class="nf">expression</span><span class="p">.</span><span class="nf">source_buffer</span>
    <span class="n">sb</span><span class="p">.</span><span class="nf">tokens</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">token</span><span class="o">|</span>
      <span class="k">if</span> <span class="n">eligible_kw</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">token</span><span class="p">.</span><span class="nf">keyword_kind</span><span class="p">)</span> <span class="o">||</span> <span class="n">eligible_tokens</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">token</span><span class="p">.</span><span class="nf">token</span><span class="p">)</span>
        <span class="n">range</span> <span class="o">=</span> <span class="no">Parser</span><span class="o">::</span><span class="no">Source</span><span class="o">::</span><span class="no">Range</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">sb</span><span class="p">,</span> <span class="n">token</span><span class="p">.</span><span class="nf">start</span><span class="p">,</span> <span class="n">token</span><span class="p">.</span><span class="nf">end</span><span class="p">)</span>
        <span class="n">replace</span><span class="p">(</span><span class="n">range</span><span class="p">,</span> <span class="n">range</span><span class="p">.</span><span class="nf">source</span><span class="p">.</span><span class="nf">upcase</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="nb">require</span> <span class="s1">'fast/cli'</span>
  <span class="nb">puts</span> <span class="no">Fast</span><span class="p">.</span><span class="nf">highlight</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="ss">sql: </span><span class="kp">true</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="anonymize-sql">Anonymize SQL</h2>

<p>Another cool example on manipulating SQL via AST is <a href="/anonymizing-your-sql">anonymize it</a>.</p>

<p>Here’s a simple anonymizer that transform table names and references.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Fast</span><span class="p">.</span><span class="nf">shortcut</span> <span class="ss">:anonymize_sql</span> <span class="k">do</span>
  <span class="nb">require</span> <span class="s1">'fast/sql'</span>
  <span class="n">file</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">.</span><span class="nf">last</span>
  <span class="nb">method</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">exist?</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="p">?</span> <span class="ss">:parse_sql_file</span> <span class="p">:</span> <span class="ss">:parse_sql</span>
  <span class="n">ast</span> <span class="o">=</span> <span class="no">Fast</span><span class="p">.</span><span class="nf">public_send</span><span class="p">(</span><span class="nb">method</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
  <span class="n">memo</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="n">relnames</span> <span class="o">=</span> <span class="n">search</span><span class="p">(</span><span class="s2">"(relname $_)"</span><span class="p">,</span> <span class="n">ast</span><span class="p">).</span><span class="nf">grep</span><span class="p">(</span><span class="no">String</span><span class="p">).</span><span class="nf">uniq</span>
  <span class="n">pattern</span> <span class="o">=</span> <span class="s2">"{relname (sval {</span><span class="si">#{</span><span class="n">relnames</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:inspect</span><span class="p">).</span><span class="nf">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span><span class="si">}</span><span class="s2">})}"</span>
  <span class="nb">puts</span> <span class="s2">"searching with </span><span class="si">#{</span><span class="n">pattern</span><span class="si">}</span><span class="s2">"</span>

  <span class="n">content</span> <span class="o">=</span> <span class="no">Fast</span><span class="o">::</span><span class="no">SQL</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">ast</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">node</span><span class="o">|</span>
    <span class="n">new_name</span> <span class="o">=</span> <span class="n">memo</span><span class="p">[</span><span class="n">node</span><span class="p">.</span><span class="nf">source</span><span class="p">.</span><span class="nf">tr</span><span class="p">(</span><span class="sx">%|"'|</span><span class="p">,</span> <span class="s1">''</span><span class="p">)]</span> <span class="o">||=</span> <span class="s2">"x</span><span class="si">#{</span><span class="n">memo</span><span class="p">.</span><span class="nf">size</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">new_name</span> <span class="o">=</span> <span class="s2">"'</span><span class="si">#{</span><span class="n">new_name</span><span class="si">}</span><span class="s2">'"</span> <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="nf">type</span> <span class="o">==</span> <span class="ss">:sval</span>
    <span class="n">replace</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="nf">loc</span><span class="p">.</span><span class="nf">expression</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="nb">puts</span> <span class="no">Fast</span><span class="p">.</span><span class="nf">highlight</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="ss">sql: </span><span class="kp">true</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="my-latest-experiments-with-sql-ast">My latest experiments with SQL AST</h2>

<p>Now, let’s talk about my latest exciting project that is about
<a href="https://github.com/timescale/timescaledb">TimescaleDB</a>
and recognize framework standards and feature adoption.</p>

<p>Let’s dive into a simple example that allows me to explain my intention.</p>

<p>I’m going to track temperatures of different locations but my database will be
massive, so I’m going to use the <code class="language-plaintext highlighter-rouge">hypertables</code> to automatically partition the
table by month.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">temperatures</span>
<span class="p">(</span> <span class="nb">time</span> <span class="nb">TIMESTAMP</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">location</span> <span class="nb">varchar</span><span class="p">,</span>
  <span class="n">value</span> <span class="nb">decimal</span><span class="p">);</span>

<span class="c1">-- automatic partitioning by month</span>
<span class="k">SELECT</span> <span class="n">create_hypertable</span><span class="p">(</span><span class="s1">'temperatures'</span><span class="p">,</span>
  <span class="n">by_range</span><span class="p">(</span><span class="s1">'time'</span><span class="p">,</span> <span class="n">INTERVAL</span> <span class="s1">'1 month'</span><span class="p">));</span>
</code></pre></div></div>

<p>The <a href="https://docs.timescale.com/api/latest/hypertable/create_hypertable/">create_hypertable</a>
function will allow you to insert on the <code class="language-plaintext highlighter-rouge">temperatures</code> but behind the scenes
it’s splitting and saving the data into a monthly chunk.</p>

<h2 id="inserting-data">Inserting data</h2>

<p>The focus here is not on splitting the data either inserting, but I’m going to
put some examples to make the full scenario understanding:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">temperatures</span> <span class="p">(</span> <span class="k">location</span><span class="p">,</span> <span class="nb">time</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="k">VALUES</span>
<span class="p">(</span> <span class="s1">'kitchen'</span><span class="p">,</span>   <span class="s1">'2000-01-01 12:20:00'</span><span class="p">,</span> <span class="mi">22</span><span class="p">.</span><span class="mi">2</span><span class="p">),</span>
<span class="p">(</span> <span class="s1">'kitchen'</span><span class="p">,</span>   <span class="s1">'2000-01-01 12:32:00'</span><span class="p">,</span> <span class="mi">22</span><span class="p">.</span><span class="mi">8</span><span class="p">),</span>
<span class="p">(</span> <span class="s1">'bedroom'</span><span class="p">,</span>   <span class="s1">'2000-01-01 12:22:00'</span><span class="p">,</span> <span class="mi">22</span><span class="p">.</span><span class="mi">8</span><span class="p">),</span>
<span class="p">(</span> <span class="s1">'bedroom'</span><span class="p">,</span>   <span class="s1">'2000-01-01 14:33:00'</span><span class="p">,</span> <span class="mi">24</span><span class="p">.</span><span class="mi">2</span><span class="p">);</span>
</code></pre></div></div>
<h2 id="querying-aggregated-data">Querying aggregated data</h2>

<p>Here’s the tricky part of using time series data. Most of it will be called by
statistics that aggregates the data in somehow. Let’s get the average hourly
temperature:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">time_bucket</span><span class="p">(</span><span class="s1">'1h'</span><span class="p">,</span> <span class="nb">time</span><span class="p">)</span> <span class="k">as</span> <span class="nb">time</span><span class="p">,</span>
  <span class="k">location</span><span class="p">,</span>
  <span class="k">avg</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">as</span> <span class="n">value</span>
  <span class="k">FROM</span> <span class="n">temperatures</span>
  <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">;</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">time_bucket</code> is offered by the timescaledb extension and works like <code class="language-plaintext highlighter-rouge">date_trunc</code>
but a bit more advanced and prepared for Timescale features.</p>

<h2 id="creating-a-materialized-view">Creating a materialized view</h2>

<p>Now, you can imagine that putting the most frequent queries into materialized
views is a good idea, so you can make the values persistent and avoid
reprocessing.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="n">MATERIALIZED</span> <span class="k">VIEW</span>  <span class="n">avg_temperature_by_hour</span>
<span class="k">WITH</span> <span class="p">(</span><span class="n">timescaledb</span><span class="p">.</span><span class="n">continuous</span><span class="p">)</span> <span class="k">AS</span>
<span class="k">SELECT</span> <span class="n">time_bucket</span><span class="p">(</span><span class="s1">'1h'</span><span class="p">,</span> <span class="nb">time</span><span class="p">)</span> <span class="k">as</span> <span class="nb">time</span><span class="p">,</span>
  <span class="k">location</span><span class="p">,</span>
  <span class="k">avg</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">as</span> <span class="n">value</span>
  <span class="k">FROM</span> <span class="n">temperatures</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<span class="k">WITH</span> <span class="k">DATA</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="my-experiment---a-small-linter">My experiment - a small linter</h2>

<p>Now let’s talk about the experiment, you can imagine a linter saying:</p>

<blockquote>
  <p>Hey buddy, I see you’re querying from the hypertable
but you also have the materialized view.
Let’s use the materialized view instead.</p>
</blockquote>

<h3 id="learning-the-ast-patterns">Learning the AST patterns</h3>

<p>The first thing to build your pattern, is understand the AST. I build a
minimalistic expression that contains the fragment I’m looking for:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">puts</span> <span class="no">Fast</span><span class="p">.</span><span class="nf">parse_sql</span><span class="p">(</span><span class="s2">"SELECT time_bucket('1h', now())"</span><span class="p">)</span>
</code></pre></div></div>

<p>Outputs:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span><span class="k">select</span><span class="nt">-stmt</span>
  <span class="o">(</span>target-list
    <span class="o">(</span>res-target
      <span class="o">(</span>val
        <span class="o">(</span>func-call
          <span class="o">(</span>funcname
            <span class="o">(</span>string
              <span class="o">(</span>sval <span class="s2">"time_bucket"</span><span class="o">)))</span>
          <span class="o">(</span>args
            <span class="o">(</span>a-const
              <span class="o">(</span>sval
                <span class="o">(</span>sval <span class="s2">"1h"</span><span class="o">)))</span>
            <span class="o">(</span>func-call
              <span class="o">(</span>funcname
                <span class="o">(</span>string
                  <span class="o">(</span>sval <span class="s2">"now"</span><span class="o">)))</span>
              <span class="o">(</span>funcformat :COERCE_EXPLICIT_CALL<span class="o">)))</span>
          <span class="o">(</span>funcformat :COERCE_EXPLICIT_CALL<span class="o">))))))</span>
</code></pre></div></div>

<p>Now, I can also build a pattern for detecting select with time_bucket from
hypertable.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Fast</span><span class="p">.</span><span class="nf">shortcut</span> <span class="ss">:check_query</span> <span class="k">do</span> 
  <span class="n">pattern</span> <span class="o">=</span> <span class="o">&lt;&lt;~</span><span class="no">FAST</span><span class="sh">
  (select_stmt
    (target_list #call_time_bucket)
    (from_clause #from_hypertable)
</span><span class="no">  FAST</span>
  <span class="n">search_all</span> <span class="n">pattern</span><span class="p">,</span> <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Now, you can see I’m introducing <code class="language-plaintext highlighter-rouge">#method_match</code> to allow to build more readable 
patterns and delegate part of it to my favorite programming language. So, let’s
specify the methods:</p>

<p>The <code class="language-plaintext highlighter-rouge">#call_time_bucket</code> pattern will just pick the first result of the
expression given:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">call_time_bucket</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
  <span class="n">node</span><span class="p">.</span><span class="nf">first</span><span class="p">(</span><span class="s1">'(func_call (funcname (string (sval "time_bucket")'</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>And the <code class="language-plaintext highlighter-rouge">from_hypertable</code> pattern will collect and double check if the
<code class="language-plaintext highlighter-rouge">hypertables</code> array contains the name.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">from_hypertable</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">relname</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="nf">capture</span><span class="p">(</span><span class="s1">'(relname $_)'</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">hypertables</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">relname</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="k">def</span> <span class="nf">hypertables</span>
  <span class="vi">@hypertables</span> <span class="o">||=</span>
    <span class="no">Timescaledb</span><span class="p">.</span><span class="nf">hypertables</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:hypertable_name</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Now, we can say, well, we have a query that matches. This query can be running
standalone or be the implementation of a materialized view. So, next step is
track what are the queries and what is the materialized views already available.</p>

<h2 id="track-query-and-materialized">Track <code class="language-plaintext highlighter-rouge">@query</code> and <code class="language-plaintext highlighter-rouge">@materialized</code></h2>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1"># Previous pattern</span>
    <span class="n">search_all</span> <span class="n">pattern</span><span class="p">,</span> <span class="no">ARGV</span><span class="p">.</span><span class="nf">last</span><span class="p">,</span> <span class="ss">parallel: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">on_result: </span><span class="o">-&gt;</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span> <span class="k">do</span>
      <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">file</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">results</span><span class="p">.</span><span class="nf">size</span><span class="si">}</span><span class="s2">"</span>
      <span class="n">results</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">node</span><span class="o">|</span>
        <span class="n">report</span> <span class="n">node</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="nf">parent</span><span class="p">.</span><span class="nf">nil?</span>
          <span class="vi">@query</span><span class="p">[</span><span class="n">node</span><span class="p">.</span><span class="nf">capture</span><span class="p">(</span><span class="s1">'(relname $_)'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">node</span>
        <span class="k">else</span>
          <span class="n">root</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="nf">ancestors</span><span class="p">.</span><span class="nf">last</span>
          <span class="c1"># ... next slide</span>
</code></pre></div></div>

<p>To map <code class="language-plaintext highlighter-rouge">@materialized</code> with the view name, we need to check if this is a <code class="language-plaintext highlighter-rouge">CREATE
MATERIALIZED VIEW</code> using <code class="language-plaintext highlighter-rouge">timescaledb.continuous</code> feature.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="n">root</span><span class="p">.</span><span class="nf">type</span>
<span class="k">when</span> <span class="ss">:create_table_as_stmt</span>
  <span class="n">view_name</span> <span class="o">=</span> <span class="o">&lt;&lt;~</span><span class="no">FAST</span><span class="sh">
    (create_table_as_stmt
      (query ... )
      (into
        (rel
          (relname $_)
          (inh true)
          (relpersistence "p"))
        (options
          (def_elem
            (defnamespace "timescaledb")
            (defname "continuous")
</span><span class="no">        FAST</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">name</span><span class="o">=</span><span class="n">root</span><span class="p">.</span><span class="nf">capture</span><span class="p">(</span><span class="n">view_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
  <span class="vi">@materialized</span><span class="p">[</span><span class="nb">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The cool part of AST, is that if we just run this shortcut over the previous SQL
fragments, it will allow you to discover that:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="vi">@query</span><span class="p">[</span><span class="s2">"temperatures"</span><span class="p">]</span> <span class="o">==</span> <span class="vi">@materialized</span><span class="p">[</span><span class="s2">"avg_temperature_by_hour"</span><span class="p">]</span> <span class="c1"># =&gt; true</span>
</code></pre></div></div>

<p>So, the AST has the same representation and we can build a recursive algorithm
to check what queries are elegible to be replaced by a materialized view.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ... previous context</span>
      <span class="vi">@query</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">table_name</span><span class="p">,</span> <span class="n">query_table</span><span class="o">|</span>
        <span class="vi">@materialized</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">view_name</span><span class="p">,</span> <span class="n">query_materialized</span><span class="o">|</span>
          <span class="k">if</span> <span class="n">query_table</span> <span class="o">==</span> <span class="n">query_materialized</span>
            <span class="nb">puts</span> <span class="s2">"The table </span><span class="si">#{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> is also tracked as a continuous aggregate of </span><span class="si">#{</span><span class="n">view_name</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="s2">""</span>
            <span class="n">report</span><span class="p">(</span><span class="n">query_table</span><span class="p">.</span><span class="nf">source</span><span class="p">)</span>
            <span class="nb">puts</span> <span class="s2">"Query the data from the materialized view to get pre-computed results"</span><span class="p">,</span> <span class="s2">""</span>
            <span class="n">report</span><span class="p">(</span><span class="s2">"SELECT * FROM </span><span class="si">#{</span><span class="n">view_name</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
          <span class="k">end</span>
        <span class="k">end</span>
</code></pre></div></div>

<h3 id="demo">Demo</h3>

<p>Running the demo with the previous sql fragments mapped in a <code class="language-plaintext highlighter-rouge">demo.sql</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> fast .check_query demo.sql
The table temperatures is also tracked as a continuous aggregate of avg_temperature_by_hour

SELECT time_bucket<span class="o">(</span><span class="s1">'1h'</span>, <span class="nb">time</span><span class="o">)</span> as <span class="nb">time</span>,
  location,
  avg<span class="o">(</span>value<span class="o">)</span> as value
  FROM temperatures
  GROUP BY 1,2

Query the data from the materialized view to get pre-computed results

SELECT <span class="k">*</span> FROM avg_temperature_by_hour
</code></pre></div></div>

<p>Yay! I got the final output as expected! I was able to create a linter that uses
database metadata combined with AST metadata to intercept and teach a developer
that needs a new direction.</p>

<p>I love building this type of primitive tools 🫶.</p>

<p>Playing with toys from compiler level is fun and very powerful!</p>

<h2 id="the-future">The future</h2>

<p>My plan for the future is try to help the query planner in the ORM level.
Integrate with the <a href="https://github.com/jonatas/timescaledb">timescaledb gem</a> to
replace queries before the query planner.</p>

<p>I can’t see myself able to go to such implementation in the core level of postgresql
but I can build a small prototype that proves the concept.</p>

<h2 id="sources">Sources</h2>

<p>Here are a few sources if you want to go deeper:</p>

<ul>
  <li><a href="https://github.com/jonatas/fast">https://github.com/jonatas/fast</a></li>
  <li><a href="https://ideia.me/fast-supports-sql">https://ideia.me/fast-supports-sql</a></li>
  <li><a href="https://ideia.me/building-a-sql-formatter-with-fast">https://ideia.me/building-a-sql-formatter-with-fast</a></li>
  <li><a href="https://ideia.me/anonymizing-your-sql">https://ideia.me/anonymizing-your-sql</a></li>
</ul>

<p>I build this article as a way to document my talk “Grepping SQL like a boss”
at <a href="https://www.lambdadays.org/lambdadays2024/jonatas-paganini">Lambda Days 2024</a>
and you can find the gist to all talk files and sources to run the example here:</p>

<p><a href="https://gist.github.com/jonatas/6ba56014185855b7f2efae74d6250016">https://gist.github.com/jonatas/6ba56014185855b7f2efae74d6250016</a></p>

<hr />

<ul class="posts">
 
  <li><span class="post_date">27 May 2024</span> &raquo;<a class="post" href="/grepping-sql-code-like-a-boss">Grepping SQL Code like a boss</a></li>
 
  <li><span class="post_date">22 May 2024</span> &raquo;<a class="post" href="/postgresql-for-everything">PostgreSQL for Everything!</a></li>
 
  <li><span class="post_date">01 Mar 2024</span> &raquo;<a class="post" href="/community-is-not-for-sale">Community is not for Sale</a></li>
 
  <li><span class="post_date">26 Feb 2024</span> &raquo;<a class="post" href="/permaculture-and-programming">Permaculture and Programming</a></li>
 
  <li><span class="post_date">13 Feb 2024</span> &raquo;<a class="post" href="/semantic-fields-through-ages">Semantic Fields through Ages - A Journey in Words</a></li>
 
  <li><span class="post_date">05 Feb 2024</span> &raquo;<a class="post" href="/semantic-fields-of-mind">Semantic fields of the mind</a></li>
 
  <li><span class="post_date">20 Dec 2023</span> &raquo;<a class="post" href="/retrospective-2023">Retrospective 2023</a></li>
 
  <li><span class="post_date">30 Nov 2023</span> &raquo;<a class="post" href="/customize-multiple-refreshes-continuous-aggregates">Customize multiple refreshes for continuous aggregates</a></li>
 
  <li><span class="post_date">26 Nov 2023</span> &raquo;<a class="post" href="/anonymizing-your-sql">Anonymize your SQL statements</a></li>
 
  <li><span class="post_date">21 Nov 2023</span> &raquo;<a class="post" href="/building-a-sql-formatter-with-fast">Building a SQL formatter with Fast</a></li>
 
  <li><span class="post_date">17 Nov 2023</span> &raquo;<a class="post" href="/fast-supports-sql">Fast supports SQL from Postgresql!</a></li>
 
  <li><span class="post_date">28 May 2023</span> &raquo;<a class="post" href="/sonification-device">Sonification Device</a></li>
 
  <li><span class="post_date">28 May 2023</span> &raquo;<a class="post" href="/dispositivo-sonificacao">Dispositivo de Sonificação</a></li>
 
  <li><span class="post_date">30 Mar 2023</span> &raquo;<a class="post" href="/sirva-sua-comunidade">Sirva Sua Comunidade</a></li>
 
  <li><span class="post_date">30 Mar 2023</span> &raquo;<a class="post" href="/serve-your-community">Serve Your Community</a></li>
 
  <li><span class="post_date">12 Feb 2023</span> &raquo;<a class="post" href="/two-ways-to-notify-new-data-from-timescaledb-continuous-aggregates">Two ways to notify new data from Timescaledb Continuous Aggregates</a></li>
 
  <li><span class="post_date">12 Feb 2023</span> &raquo;<a class="post" href="/life-before-and-after-gpt">Life before and after Chat GPT</a></li>
 
  <li><span class="post_date">04 Feb 2023</span> &raquo;<a class="post" href="/hierarchical-continuous-aggregates-with-ruby">Hierarchical continuous aggregates with Ruby and Timescaledb</a></li>
 
  <li><span class="post_date">18 Oct 2022</span> &raquo;<a class="post" href="/activerecord-update-without-primary-key">ActiveRecord update without primary key</a></li>
 
  <li><span class="post_date">05 Oct 2022</span> &raquo;<a class="post" href="/libpq-no-such-file-load-error">Load error - libpq no such file</a></li>
 
  <li><span class="post_date">05 Oct 2022</span> &raquo;<a class="post" href="/identify-your-needs-and-feelings">Identify Your Needs And Feelings</a></li>
 
  <li><span class="post_date">21 Sep 2022</span> &raquo;<a class="post" href="/timescale-continuous-aggregates-with-ruby">Creating continuous aggregates with Ruby and Timescale</a></li>
 
  <li><span class="post_date">13 Sep 2022</span> &raquo;<a class="post" href="/tips-to-duplicate-massive-time-series-data-on-postgresql">Tips to duplicate massive time series data on Postgresql</a></li>
 
  <li><span class="post_date">07 Sep 2022</span> &raquo;<a class="post" href="/using-the-timescale-gem-with-ruby">Using the Timescale gem with Ruby</a></li>
 
  <li><span class="post_date">30 Aug 2022</span> &raquo;<a class="post" href="/writing-plans">Writing plans</a></li>
 
  <li><span class="post_date">29 Aug 2022</span> &raquo;<a class="post" href="/pgconfbr-talk">PGConf Brasil</a></li>
 
  <li><span class="post_date">24 May 2021</span> &raquo;<a class="post" href="/time-series-benchmark-timescaledb-raspberry-pi">Time Series Benchmark Timescaledb Raspberry Pi</a></li>
 
  <li><span class="post_date">21 May 2021</span> &raquo;<a class="post" href="/ssh-connection-refused">SSH connection refused</a></li>
 
  <li><span class="post_date">14 May 2021</span> &raquo;<a class="post" href="/my-first-month-at-timescale">My first month at Timescale</a></li>
 
  <li><span class="post_date">17 Apr 2021</span> &raquo;<a class="post" href="/my-first-week-at-timescale">My first week at Timescale</a></li>
 
  <li><span class="post_date">23 Feb 2019</span> &raquo;<a class="post" href="/complex-ast-search-with-ruby">Complex AST search with Ruby</a></li>
 
  <li><span class="post_date">06 Jan 2019</span> &raquo;<a class="post" href="/image-processing-with-rmagick">Image processing with Ruby</a></li>
 
  <li><span class="post_date">30 Dec 2018</span> &raquo;<a class="post" href="/retrospective-2018">Retrospective 2018</a></li>
 
  <li><span class="post_date">21 Dec 2017</span> &raquo;<a class="post" href="/retrospective-2017">Retrospective 2017</a></li>
 
  <li><span class="post_date">30 Nov 2017</span> &raquo;<a class="post" href="/customize-rubocop-layout-class-structure-cop">Customize RuboCop Layout/ClassStructure cop</a></li>
 
  <li><span class="post_date">21 Nov 2017</span> &raquo;<a class="post" href="/the-dynamic-experiment-initiative">The dynamic experiment initiative</a></li>
 
  <li><span class="post_date">04 Aug 2017</span> &raquo;<a class="post" href="/adventures-on-automated-code-replacement">Adventures on automated code replacement</a></li>
 
  <li><span class="post_date">20 Jul 2017</span> &raquo;<a class="post" href="/my-nomad-life">My nomad life</a></li>
 
  <li><span class="post_date">31 May 2017</span> &raquo;<a class="post" href="/parsing-ruby-code">Parsing Ruby Code</a></li>
 
  <li><span class="post_date">20 May 2017</span> &raquo;<a class="post" href="/search-in-ruby-ast">Search in Ruby AST</a></li>
 
  <li><span class="post_date">13 Aug 2016</span> &raquo;<a class="post" href="/ruby-puzzle-gridlock">Gridlock game - solving with Ruby</a></li>
 
  <li><span class="post_date">27 Jul 2016</span> &raquo;<a class="post" href="/trabalhar-sozinho-ou-contribuir">Trabalhar sozinho ou contribuir?</a></li>
 
  <li><span class="post_date">05 Jun 2016</span> &raquo;<a class="post" href="/the-dev-conf-sp-2016">TDC SP 2016 here we go :)</a></li>
 
  <li><span class="post_date">22 May 2016</span> &raquo;<a class="post" href="/pessoas-codigos-comunicacao">Pessoas, códigos, comunicação</a></li>
 
  <li><span class="post_date">17 Apr 2016</span> &raquo;<a class="post" href="/introducao-linguagem-ruby">Introdução a linguagem Ruby</a></li>
 
  <li><span class="post_date">01 Apr 2016</span> &raquo;<a class="post" href="/programar-e-uma-droga">Programar é uma droga</a></li>
 
  <li><span class="post_date">25 Mar 2016</span> &raquo;<a class="post" href="/tdc-online">TDC Online! Here we go!</a></li>
 
  <li><span class="post_date">24 Mar 2016</span> &raquo;<a class="post" href="/google-cloud-platform">Google Cloud Platform</a></li>
 
  <li><span class="post_date">22 Mar 2016</span> &raquo;<a class="post" href="/automate-first">Automatize primeiro</a></li>
 
  <li><span class="post_date">19 Mar 2016</span> &raquo;<a class="post" href="/lorenzo-ideia-me-no-ar">lorenzo.ideia.me no ar!</a></li>
 
  <li><span class="post_date">16 Mar 2016</span> &raquo;<a class="post" href="/comecando-com-go-lang">Começando com GO Lang</a></li>
 
  <li><span class="post_date">15 Mar 2016</span> &raquo;<a class="post" href="/vim-basico-para-ruby">Vim básico para trabalhar com Ruby</a></li>
 
  <li><span class="post_date">14 Mar 2016</span> &raquo;<a class="post" href="/fish-shell">Fish shell</a></li>
 
  <li><span class="post_date">14 Mar 2016</span> &raquo;<a class="post" href="/buscando-com-silver-searcher-aka-ag">Buscando com silver searcher</a></li>
 
  <li><span class="post_date">22 Feb 2016</span> &raquo;<a class="post" href="/um-ano-na-resultados-digitais">Primeiro Ano na RD</a></li>
 
  <li><span class="post_date">14 Feb 2016</span> &raquo;<a class="post" href="/podcast-boa-noite-lorenzo">Podcast Boa Noite Lorenzo</a></li>
 
  <li><span class="post_date">05 Dec 2015</span> &raquo;<a class="post" href="/vida-de-bike">Vida de bike</a></li>
 
  <li><span class="post_date">15 Nov 2015</span> &raquo;<a class="post" href="/railsrumble-2015">Rails Rumble 2015</a></li>
 
  <li><span class="post_date">27 Sep 2015</span> &raquo;<a class="post" href="/coffeescript-rocks">Coffeescript rocks</a></li>
 
  <li><span class="post_date">10 Sep 2015</span> &raquo;<a class="post" href="/from-linux-to-os-x">Migrando do linux para o Mac OS X</a></li>
 
  <li><span class="post_date">28 Aug 2015</span> &raquo;<a class="post" href="/tutorial-programacao-3D-openscad">Programação 3D com OpenSCad</a></li>
 
  <li><span class="post_date">24 Aug 2015</span> &raquo;<a class="post" href="/6-meses-na-resultados-digitais">6 meses na Resultados Digitais</a></li>
 
  <li><span class="post_date">14 Jul 2015</span> &raquo;<a class="post" href="/TDC-SP-here-we-go">TDC SP here we go :)</a></li>
 
  <li><span class="post_date">01 Jun 2015</span> &raquo;<a class="post" href="/vida-de-busao">Vida de busão</a></li>
 
  <li><span class="post_date">28 May 2015</span> &raquo;<a class="post" href="/perguntas-do-meu-filho-de-3-anos">Perguntas do meu filho de 3 anos</a></li>
 
  <li><span class="post_date">26 May 2015</span> &raquo;<a class="post" href="/tres-meses-na-resultados-digitais">Três meses na Resultados Digitais</a></li>
 
  <li><span class="post_date">04 Apr 2015</span> &raquo;<a class="post" href="/produto-ou-servico">Produto ou serviço?</a></li>
 
  <li><span class="post_date">23 Mar 2015</span> &raquo;<a class="post" href="/primeiro-mes-na-resultados-digitais">Primeiro mês na Resultados Digitais</a></li>
 
  <li><span class="post_date">01 Mar 2015</span> &raquo;<a class="post" href="/primeira-semana-na-resultados-digitais">Primeira semana na Resultados Digitais</a></li>
 
  <li><span class="post_date">23 Dec 2014</span> &raquo;<a class="post" href="/retrospectiva-2014">Retrospectiva 2014</a></li>
 
  <li><span class="post_date">27 Oct 2014</span> &raquo;<a class="post" href="/blog-da-inventto">Blog da invent.to</a></li>
 
  <li><span class="post_date">22 Apr 2014</span> &raquo;<a class="post" href="/raspibian-sem-mouse">Raspibian sem mouse</a></li>
 
  <li><span class="post_date">09 Apr 2014</span> &raquo;<a class="post" href="/coisas-legais-para-fazer-com-o-rpi">Coisas legais para fazer com o Raspberry PI</a></li>
 
  <li><span class="post_date">07 Apr 2014</span> &raquo;<a class="post" href="/bone-debian-rodando-no-beaglebone-black">Bone Debian rodando no BeagleBone Black</a></li>
 
  <li><span class="post_date">03 Apr 2014</span> &raquo;<a class="post" href="/como-gerar-um-video-de-fotos-sequenciais">Como gerar um vídeo de fotos sequênciais</a></li>
 
  <li><span class="post_date">01 Apr 2014</span> &raquo;<a class="post" href="/rotative-timelapse">Timelapse girando no Raspberry PI</a></li>
 
  <li><span class="post_date">29 Jan 2014</span> &raquo;<a class="post" href="/desenvolvemos-seu-invento">Desenvolvemos seu invento!</a></li>
 
  <li><span class="post_date">23 Dec 2013</span> &raquo;<a class="post" href="/retrospectiva-2013">Retrospectiva 2013</a></li>
 
  <li><span class="post_date">21 Oct 2013</span> &raquo;<a class="post" href="/re-inventto-esta-no-ar">ReInvent.to está no ar!</a></li>
 
  <li><span class="post_date">16 Oct 2013</span> &raquo;<a class="post" href="/railsrumble-vem-ai">Rails Rumble vem aí</a></li>
 
  <li><span class="post_date">29 Jul 2013</span> &raquo;<a class="post" href="/diversidade-e-riqueza">A diversidade é a riqueza</a></li>
 
  <li><span class="post_date">27 Jul 2013</span> &raquo;<a class="post" href="/site-arteterapia-no-ar">Arteterapia no ar!</a></li>
 
  <li><span class="post_date">23 Jul 2013</span> &raquo;<a class="post" href="/o-que-tira-meu-tempo">O que tira o meu tempo?</a></li>
 
  <li><span class="post_date">28 Jun 2013</span> &raquo;<a class="post" href="/pensando-no-futuro">Pensando No Futuro</a></li>
 
  <li><span class="post_date">26 Jun 2013</span> &raquo;<a class="post" href="/bliss-ideia-me-no-ar">Bliss ideia.me está no ar!</a></li>
 
  <li><span class="post_date">10 Jun 2013</span> &raquo;<a class="post" href="/o-que-ando-ideiando">O que ando fazendo nos últimos dias</a></li>
 
  <li><span class="post_date">05 May 2013</span> &raquo;<a class="post" href="/fim-de-semana-bliss">Fim de semana bliss</a></li>
 
  <li><span class="post_date">01 May 2013</span> &raquo;<a class="post" href="/git-post-receive">Git Post Receive</a></li>
 
  <li><span class="post_date">24 Apr 2013</span> &raquo;<a class="post" href="/migrando-estilo-para-twitter-bootstrap">Jekyll e Twitter Bootstrap</a></li>
 
  <li><span class="post_date">18 Apr 2013</span> &raquo;<a class="post" href="/observando-a-memoria-ruby">Observando a memória no ruby</a></li>
 
  <li><span class="post_date">18 Apr 2013</span> &raquo;<a class="post" href="/experiencias-meteor">Experiências com o Meteor js</a></li>
 
  <li><span class="post_date">08 Apr 2013</span> &raquo;<a class="post" href="/pixel-no-ar">Pixel no ar!</a></li>
 
  <li><span class="post_date">01 Apr 2013</span> &raquo;<a class="post" href="/flu-ideia-me-no-ar">Flu.ideia.me no ar!</a></li>
 
  <li><span class="post_date">05 Mar 2013</span> &raquo;<a class="post" href="/concentracao-na-era-da-distracao">Concentração na era da distração</a></li>
 
  <li><span class="post_date">14 Dec 2012</span> &raquo;<a class="post" href="/retro-2012">Retrospectiva 2012</a></li>
 
  <li><span class="post_date">03 Dec 2012</span> &raquo;<a class="post" href="/moving-the-homeoffice">Home office de mudança</a></li>
 
  <li><span class="post_date">24 Nov 2012</span> &raquo;<a class="post" href="/efetivamente">Efetivamente....</a></li>
 
  <li><span class="post_date">11 Nov 2012</span> &raquo;<a class="post" href="/meu-filho-ja-vai-fazer-um-ano">Meu primeiro filho e seu primeiro ano</a></li>
 
  <li><span class="post_date">11 Nov 2012</span> &raquo;<a class="post" href="/arteterapia-begins">Arteterapia o início</a></li>
 
  <li><span class="post_date">08 Nov 2012</span> &raquo;<a class="post" href="/churumelas-no-ar">Não me venha com churumelas!</a></li>
 
  <li><span class="post_date">18 Oct 2012</span> &raquo;<a class="post" href="/rails-rumble-se-foi-e-churumelas-esta-no-ar">Como foi a Rails Rumble 2012</a></li>
 
  <li><span class="post_date">01 Oct 2012</span> &raquo;<a class="post" href="/rails-rumble-ideias">Ideias sobre o Rails Rumble</a></li>
 
  <li><span class="post_date">13 Sep 2012</span> &raquo;<a class="post" href="/os-programadores-do-futuro">Os programadores do futuro</a></li>
 
  <li><span class="post_date">23 May 2012</span> &raquo;<a class="post" href="/disciplina-no-home-office">Disciplina no home office</a></li>
 
  <li><span class="post_date">08 May 2012</span> &raquo;<a class="post" href="/galaxy-note-n7000">Sansung Galaxy Note N7000</a></li>
 
  <li><span class="post_date">09 Apr 2012</span> &raquo;<a class="post" href="/update-ou-upgrade-parte-2">Update ou upgrade parte 2</a></li>
 
  <li><span class="post_date">01 Apr 2012</span> &raquo;<a class="post" href="/cursando-aulas-da-stanford">Cursando aulas da Stanford University</a></li>
 
  <li><span class="post_date">30 Mar 2012</span> &raquo;<a class="post" href="/terminal-life">Vida no terminal</a></li>
 
  <li><span class="post_date">29 Mar 2012</span> &raquo;<a class="post" href="/update-ou-upgrade">Update ou upgrade</a></li>
 
  <li><span class="post_date">25 Mar 2012</span> &raquo;<a class="post" href="/usabilidade-versus-simplicidade">Usabilidade versus simplicidade</a></li>
 
  <li><span class="post_date">13 Mar 2012</span> &raquo;<a class="post" href="/camera-overlay-open-source">Câmera Overlay Open Source</a></li>
 
  <li><span class="post_date">08 Mar 2012</span> &raquo;<a class="post" href="/chave-dicotomica-android">Chave Dicotômica</a></li>
 
  <li><span class="post_date">07 Mar 2012</span> &raquo;<a class="post" href="/pequenas-decisoes-grandes-mudancas">Pequenas mudanças e grandes decisões</a></li>
 
  <li><span class="post_date">27 Feb 2012</span> &raquo;<a class="post" href="/camera-overlay">Camera Overlay</a></li>
 
  <li><span class="post_date">12 Jul 2010</span> &raquo;<a class="post" href="/sinceridade-nao-faz-mal-a-ninguem">Sinceridade não faz mal a ninguém</a></li>
 
  <li><span class="post_date">07 Jul 2010</span> &raquo;<a class="post" href="/ingles-legal">Inglês Legal</a></li>
 
  <li><span class="post_date">30 Jun 2010</span> &raquo;<a class="post" href="/problemas-no-software">Problemas no software e hardware</a></li>
 
  <li><span class="post_date">27 Jun 2010</span> &raquo;<a class="post" href="/cognitividade-da-interface">Cognitividade da Interface</a></li>
 
  <li><span class="post_date">18 Jun 2010</span> &raquo;<a class="post" href="/ipad-chegou">Meu iPad Chegou!</a></li>
 
  <li><span class="post_date">11 Jun 2010</span> &raquo;<a class="post" href="/palestra-sobre-ruby-e-rails">Palestra na Vizivali</a></li>
 
  <li><span class="post_date">30 May 2010</span> &raquo;<a class="post" href="/sh-legal">SH Legal</a></li>
 
  <li><span class="post_date">21 May 2010</span> &raquo;<a class="post" href="/sistemas-operacionais-gerencia-processador-pt1">Sistemas Operacionais - Gerência do processador - parte 1</a></li>
 
  <li><span class="post_date">19 May 2010</span> &raquo;<a class="post" href="/javascript-legal">Javascript Ninja Legal</a></li>
 
  <li><span class="post_date">18 May 2010</span> &raquo;<a class="post" href="/iteracao-legal">Iteração legal</a></li>
 
  <li><span class="post_date">16 May 2010</span> &raquo;<a class="post" href="/coffeescript-legal">Coffeescript Legal</a></li>
 
  <li><span class="post_date">13 May 2010</span> &raquo;<a class="post" href="/servicos-google-api">Google Api</a></li>
 
  <li><span class="post_date">13 May 2010</span> &raquo;<a class="post" href="/linguagens-e-o-mundo">As linguagens e o mundo</a></li>
 
  <li><span class="post_date">05 May 2010</span> &raquo;<a class="post" href="/google-legal">Nova roda mágica do google</a></li>
 
  <li><span class="post_date">03 May 2010</span> &raquo;<a class="post" href="/ruby-legal">Ruby Legal</a></li>
 
  <li><span class="post_date">03 May 2010</span> &raquo;<a class="post" href="/google-buzz-api-no-ideiame">Integrando API do Google Buzz no Ideia.me</a></li>
 
  <li><span class="post_date">29 Apr 2010</span> &raquo;<a class="post" href="/find-exec">Usufruindo do comando find do Unix</a></li>
 
  <li><span class="post_date">27 Apr 2010</span> &raquo;<a class="post" href="/curriculo-jonatas-davi-paganini">Jônatas Davi Paganini</a></li>
 
  <li><span class="post_date">21 Apr 2010</span> &raquo;<a class="post" href="/diario-de-um-feriado">Diário de um feriado</a></li>
 
  <li><span class="post_date">18 Apr 2010</span> &raquo;<a class="post" href="/novas-cores-no-site">Novas cores no site</a></li>
 
  <li><span class="post_date">31 Mar 2010</span> &raquo;<a class="post" href="/weborb-active-record">WebOrb + ActiveRecord</a></li>
 
  <li><span class="post_date">25 Mar 2010</span> &raquo;<a class="post" href="/a-importancia-dos-baby-steps">A importância dos baby steps</a></li>
 
  <li><span class="post_date">22 Mar 2010</span> &raquo;<a class="post" href="/helplate">Helplate = Help + Template</a></li>
 
  <li><span class="post_date">04 Mar 2010</span> &raquo;<a class="post" href="/modos-so">Aula de Sistemas Operacionais - Modos do Kernel</a></li>
 
  <li><span class="post_date">02 Mar 2010</span> &raquo;<a class="post" href="/cartao-de-visitas">Cartão de visitas</a></li>
 
  <li><span class="post_date">01 Mar 2010</span> &raquo;<a class="post" href="/regexp-com-grep">Expressões Regulares com grep</a></li>
 
  <li><span class="post_date">25 Feb 2010</span> &raquo;<a class="post" href="/inspecionando-formulas-em-ruby">Inspecionando fórmulas em ruby</a></li>
 
  <li><span class="post_date">23 Feb 2010</span> &raquo;<a class="post" href="/regexp-maravilha">Expressões Regulares + Ruby = \*maravilhas</a></li>
 
  <li><span class="post_date">22 Feb 2010</span> &raquo;<a class="post" href="/sql-comentado">A linguagem SQL</a></li>
 
  <li><span class="post_date">21 Feb 2010</span> &raquo;<a class="post" href="/postgresql-tricks">PostgreSql Tricks</a></li>
 
  <li><span class="post_date">16 Feb 2010</span> &raquo;<a class="post" href="/inspecionando-regexp-com-sinatra">Inspecionando expressões regulares com Sinatra!</a></li>
 
  <li><span class="post_date">14 Feb 2010</span> &raquo;<a class="post" href="/leiaute-iphone">Leiaute para iPhone no Ideia.me</a></li>
 
  <li><span class="post_date">14 Feb 2010</span> &raquo;<a class="post" href="/google-code-playground">Google code playground</a></li>
 
  <li><span class="post_date">14 Feb 2010</span> &raquo;<a class="post" href="/estorias-bonitas-vs-testes-unitarios">Estórias Bonitas vs Testes Unitários</a></li>
 
  <li><span class="post_date">13 Feb 2010</span> &raquo;<a class="post" href="/rml-resume-markup-language">RML - Resume Markup Language</a></li>
 
  <li><span class="post_date">11 Feb 2010</span> &raquo;<a class="post" href="/de-volta-ao-tex">De volta as aulas</a></li>
 
  <li><span class="post_date">03 Feb 2010</span> &raquo;<a class="post" href="/bom-dia-a-dia">Bom dia a dia do desenvolvimento</a></li>
 
  <li><span class="post_date">01 Feb 2010</span> &raquo;<a class="post" href="/portfolio">Portfolio::Base</a></li>
 
  <li><span class="post_date">01 Feb 2010</span> &raquo;<a class="post" href="/curriculo">Currículo</a></li>
 
  <li><span class="post_date">31 Jan 2010</span> &raquo;<a class="post" href="/prototipo-site">Protótipo do site</a></li>
 
</ul>

  </div>
</div>


    </div>
  </body>
</html>

