
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NV80WM9HT0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NV80WM9HT0');
</script>

    <meta charset="utf-8">
    <title>WebOrb + ActiveRecord</title>
    
    <meta name="author" content="Jônatas Davi Paganini">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link id="bootstrap" href="/css/bootstrap.css" rel="stylesheet">
    <link id="bootstrap" href="/css/bootswatch.min.css" rel="stylesheet">
    <link href="/css/nimbus-pygments.css" rel="stylesheet">

    <script src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/bootstrap-dropdown.js"></script>
    <div id="fb-root"></div>

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
  <script type="text/javascript" language="javascript" charset="utf-8">
// <![CDATA[
    addEventListener('load', function (event) {
      var agent=navigator.userAgent.toLowerCase();
      var links = document.getElementsByTagName('a');
      var regex = new RegExp('^'+window.location.protocol + '//' + window.location.hostname);

      for (var i = 0, linksLength = links.length; i < linksLength; i++) {
        if ( ! links[i].href.match(regex)) {
           links[i].setAttribute('target', '_blank');
       }
     }

    }, false);
// ]]>
</script>
</head>
<body>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v2.5&appId=138593009602387";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a href="/">
            <img class="img-circle" alt="ideiame logo" style="padding-top: 6px" src="/images/ideiame.png"></a>
            <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
           </button>
       </div>
   <div class="navbar-collapse collapse" id="navbar-main">
     <ul class="nav navbar-nav">
      <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Social<b class="caret"></b></a>
            <ul class="dropdown-menu" id="swatch-menu">
              <li><a href="https://github.com/jonatas">Github</a></li>
              <li><a href="https://twitter.com/jonatasdp">Twitter</a></li>
              <li><a href="https://instagram.com/jonatasdp">Instagram</a></li>
              <li><a href="https://www.meetup.com/Floripa-on-Rails/members/185190193/">Meetup</a></li>
              <li><a href="https://www.slideshare.net/jonataspaganini/">SlideShare</a></li>
              <li><a href="https://facebook.com/jonatas.paganini">Facebook</a></li>
              <li><a href="https://www.youtube.com/user/jonatasdp">Youtube</a></li>
           </ul>
          </li>
          <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Projects<b class="caret"></b></a>
            <ul class="dropdown-menu">
            <li><a href="https://github.com/jonatas/fast">Fast</a></li>
            <li><a href="http://torf.ideia.me">2015: True Or False Game</a></li>
            <li><a href="http://github.com/jonatas/pixel.ideia.me">2013: Pixel art (collaborative) </a></li>
            <li><a href="http://github.com/jonatas/trybliss">2013: Try Bliss</a</li>
            <li><a href="http://github.com/jonatas/churumelas">2012: Regexp challenges</a></li>
            <li><a href="/camera-overlay">2012: Camera Overlay </a></li>
           </ul>
          </li>
          
          
          


  
    
      
      	
      	<li><a href="/archive">Arquivo</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories">Categorias</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  



          </ul>
        </div>
      </div>
     </div>
    </div>
    <div class="container">
      
<div class="page-header">
    <h1>
       <img class="thumb img-circle" src="https://avatars0.githubusercontent.com/u/15484?s=50" title="Jônatas Davi Paganini" alt="Jônatas Davi Paganini profile pic"></img>
       WebOrb + ActiveRecord <small><br/>31/03/2010
    
      <span class="categories">
        
          <a  class="btn btn-primary" href=/categories.html#weborb-ref>weborb
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
            <span class="badge">1</span>
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
          </a>
         
          <a  class="btn btn-primary" href=/categories.html#flex-ref>flex
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
            <span class="badge">1</span>
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
          </a>
         
          <a  class="btn btn-primary" href=/categories.html#rails-ref>rails
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
            <span class="badge">7</span>
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
          </a>
         
       </span>
     
     </small>
  </h1>
</div>
<div class="content">
    <p>WebOrb tem se demonstrado muito bom no seu trabalho, estou gostando de desenvolver com ele, após descobrir que qualquer classe do ruby, não apenas as classes Service podem ser usadas como objetos remotos, fiquei muito feliz e logo tive boas experiências.</p>

<p>Boas experiências é poder chamar um ActiveRecord puramente apartir do flex:</p>

<div><pre class="prettyprint">
remoteObject = new RemoteObject();
remoteObject.destination = "Person";
remoteObject.all({"include": "address", 
                           "conditions": ["age &gt; ?",18]});
</pre></div>

<p>Para isso apenas foi necessário alguns passos:</p>

<h2 id="adicionar-a-configuração-do-serviço-remoto">Adicionar a configuração do serviço remoto:</h2>

<p>Para trabalhar com weborb, existe um arquivo no projeto em que são mapeados os serviços, por padrão está em:</p>

<p>Rails.root/config/WEB-INF/flex/remoting-config.xml</p>

<p>Neste arquivo deve ser adicionado o mapeamento entre as classes:</p>

<div><pre class="prettyprint">
&lt;destination id="Person"&gt;
  &lt;properties&gt;
    &lt;source&gt;Person&lt;/source&gt;
  &lt;/properties&gt;
&lt;/destination&gt;
</pre></div>

<h2 id="adicionar-mapeamento-dos-modelos">Adicionar mapeamento dos modelos</h2>

<p>Após isso, é necessário configurar a classe ActionScript que irá receber o modelo, para ser possível recuperar as informações. O arquivo agora é:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Rails.root/config/weborb-config.xml
</code></pre></div></div>

<div><pre class="prettyprint">
&lt;classMapping&gt;
  &lt;clientClass&gt;com.model.Person&lt;/clientClass&gt;
  &lt;serverClass&gt;Person&lt;/serverClass&gt;
  &lt;source&gt;Person&lt;/source&gt;
&lt;/classMapping&gt;
&lt;classMapping&gt;
  &lt;clientClass&gt;com.model.Address&lt;/clientClass&gt;
  &lt;serverClass&gt;Address&lt;/serverClass&gt;
  &lt;source&gt;Person&lt;/source&gt;
&lt;/classMapping&gt;
</pre></div>

<h2 id="verificar-os-modelos-do-rails">Verificar os modelos do Rails</h2>

<p>No model, sabe-se que é usado classes ActiveRecord como:</p>

<div><pre class="prettyprint">
class Person &lt; ActiveRecord::Base
   belongs_to :address
end
class Address &lt; ActiveRecord::Base
end
</pre></div>

<h2 id="verificar-os-modelos-do-actionscript">Verificar os modelos do ActionScript</h2>

<p>A classe model do ActionScript deve possuir os atributos que serão instanciados no Flex:</p>

<div><pre class="prettyprint">
package com.model {
  [RemoteClass(alias="com.model.Person")]
  public class Person {
    public var name:String;
    public var age:Number;
    public var address:Address;
    
    public function Person() {
    }
  }
}
</pre></div>

<h2 id="compatibilizar-os-hashs-do-rails-e-actionscript">Compatibilizar os hashs do Rails e ActionScript</h2>

<p>Após isso, existe um pequeno problema entre as classes que são usadas como serviços, que o Hash do flex, converte as chaves como string, por não possuir símbolos, então é necessário fazer um pequeno hack no método find por exemplo:</p>

<div><pre class="prettyprint">
module SymbolizeArgs 
  module ClassMethods
    # this hack should be used by remoteObjects 
    # that just pass a Hash with string keys
    # because this we need to symbolize the keys
    def find_with_simbolyzed_keys( *args ) 
      options = {}
      old_options = args.extract_options!
      old_options.each{|key,value|
        if key.kind_of?(String) 
          options[key.to_sym] = value 
        else
          options[key] = value
        end
      }
      args.push options
      find_without_simbolyzed_keys *args
    end
  end

  def self.included(base)
    base.class_eval do
      extend ClassMethods
      class &lt;&lt; self
        alias_method_chain :find, :simbolyzed_keys
      end
    end
  end  
end

module ActiveRecord
  class Base
    include SymbolizeArgs
  end
end
</pre></div>

<p>O código acima pode ficar na pasta/arquivo: Rails.root/config/initializers/active_record_simbolyze_keys.rb</p>

<p>Com esta alteração é possível usufruir do método find com todos os seus benefícios, de uma maneira fácil, a classe ActiveRecord fica totalmente exposta ao ActionScript.</p>

<p>Se o código acima não for ativado, você receberá um erro como: “Unknown key(s): conditions (ArgumentError)”</p>

<p>ps: Inspirado em: <a href="http://onrails.org/articles/2006/10/29/part-1-using-weborb-to-access-activerecords-from-a-flex-application">http://onrails.org/articles/2006/10/29/part-1-using-weborb-to-access-activerecords-from-a-flex-application</a></p>


</div>
<hr>

<div class="share-page">
  Share &rarr;
  <a href="https://twitter.com/intent/tweet?text=WebOrb + ActiveRecord&url=https://ideia.me/weborb-active-record&via=jonatasdp&related=jonatasdp" rel="nofollow"title="Share on twitter">Twitter</a>
  <a href="https://facebook.com/sharer.php?u=https://ideia.me/weborb-active-record" rel="nofollow" target="_blank" title="Share on Facebook">Facebook</a>
  <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://ideia.me/weborb-active-record" rel="nofollow" target="_blank" title="Share on Linkedin">Linkedin</a>
</div>
<hr>
<div class="pagination">
    
      <span class="prev">
        <a href="/a-importancia-dos-baby-steps" title="A importância dos baby steps">&larr; Before</a>
      </span>
    
    | <span><a href="/archive.html">Archive</a></span> |
    
    <span class="next"><a href="/novas-cores-no-site" title="Novas cores no site">Next &rarr;</a></span>
    
</div>
<hr>

<p>
  Hello there, my name is Jônatas Davi Paganini and this is my personal blog.
  <br />
  I'm developer advocate at <a href="https://timescale.com">Timescale</a> and
  I also have a few open source projects on <a href="https://github.com/jonatas">github</a>.
</p>
<p>Check my
  <a href="/talks">talks</a> or connect with me via
  <a href="https://br.linkedin.com/in/jonatasdp" target="_blank">linkedin</a> /
  <a href="https://twitter.com/jonatasdp" target="_blank">twitter</a> /
  <a href="https://github.com/jonatas" target="_blank">github</a> /
  <a href="https://instagram.com/jonatasdp" target="_blank">instagram</a> /
  <a href="https://fb.com/jonatas.paganini" target="_blank">facebook</a> /
  <a href="https://www.strava.com/athletes/12104550" target="_blank">strava</a> /
  <a href="http://www.meetup.com/members/185190193/" target="_blank">meetup</a>.
</p>



    </div>
  </body>
</html>

